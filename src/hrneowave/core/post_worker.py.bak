# src/hrneowave/core/post_worker.py
from PyQt5.QtCore import QThread, pyqtSignal

class PostWorker(QThread):
    analysisDone = pyqtSignal(dict)

    def __init__(self, file_path: str, config: dict):
        super().__init__()
        self.file_path = file_path
        self.config = config

    def run(self):
        """Exécute le post-traitement dans un thread séparé."""
        from hrneowave.core.post_processor import PostProcessor
        
        # Crée une instance de PostProcessor avec la configuration
        processor = PostProcessor(config=self.config)
        
        # Charge les données et exécute l'analyse
        if processor.load_data_file(self.file_path):
            result = processor.run_analysis()
            if result:
                self.analysisDone.emit(processor.current_analysis)
            else:
                # Émettre un dictionnaire vide ou avec une erreur en cas d'échec de l'analyse
                self.analysisDone.emit({'error': 'Analysis failed'})
        else:
            # Émettre un dictionnaire vide ou avec une erreur en cas d'échec de chargement
            self.analysisDone.emit({'error': f'Failed to load data from {self.file_path}'})