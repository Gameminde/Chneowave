

<!DOCTYPE html>
<html class="writer-html5" lang="fr" data-content_root="../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>hrneowave.gui.view_manager &mdash; Documentation CHNeoWave 1.0.0</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../../_static/custom.css" />
      <link rel="stylesheet" type="text/css" href="../../../_static/custom.css" />

  
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../_static/documentation_options.js?v=05dadb3a"></script>
      <script src="../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../../_static/translations.js?v=e6b791cb"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Recherche" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #2980B9" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            CHNeoWave
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Rechercher docs" aria-label="Rechercher docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Référence API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../api/core.html">Module Core</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/gui.html">Module GUI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/data.html">Module Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/utils.html">Module Utils</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #2980B9" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">CHNeoWave</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Code du module</a></li>
      <li class="breadcrumb-item active">hrneowave.gui.view_manager</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Code source de hrneowave.gui.view_manager</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Gestionnaire de vues pour CHNeoWave</span>

<span class="sd">Ce module gère l&#39;affichage et la navigation entre les différentes vues de l&#39;application.</span>
<span class="sd">Il utilise des imports conditionnels pour éviter la création de widgets avant l&#39;initialisation de QApplication.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">List</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">PySide6.QtWidgets</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">QWidget</span><span class="p">,</span> <span class="n">QLabel</span><span class="p">,</span> <span class="n">QVBoxLayout</span><span class="p">,</span> <span class="n">QHBoxLayout</span><span class="p">,</span> <span class="n">QApplication</span><span class="p">,</span>
    <span class="n">QStackedWidget</span><span class="p">,</span> <span class="n">QGraphicsOpacityEffect</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">PySide6.QtCore</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">QPropertyAnimation</span><span class="p">,</span> <span class="n">QEasingCurve</span><span class="p">,</span> <span class="n">QTimer</span><span class="p">,</span> <span class="n">QObject</span><span class="p">,</span> <span class="n">Signal</span><span class="p">,</span> <span class="n">QRect</span><span class="p">,</span> <span class="n">Qt</span><span class="p">,</span> <span class="n">Slot</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">PySide6.QtGui</span><span class="w"> </span><span class="kn">import</span> <span class="n">QScreen</span>

<span class="c1"># Essayer d&#39;importer les signaux unifiés</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">hrneowave.core.unified_signals</span><span class="w"> </span><span class="kn">import</span> <span class="n">ErrorLevel</span>
    <span class="n">UNIFIED_SIGNALS_AVAILABLE</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">UNIFIED_SIGNALS_AVAILABLE</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="c1"># Créer un ErrorLevel de base si non disponible</span>
    <span class="k">class</span><span class="w"> </span><span class="nc">ErrorLevel</span><span class="p">:</span>
        <span class="n">INFO</span> <span class="o">=</span> <span class="s2">&quot;INFO&quot;</span>
        <span class="n">WARNING</span> <span class="o">=</span> <span class="s2">&quot;WARNING&quot;</span>
        <span class="n">ERROR</span> <span class="o">=</span> <span class="s2">&quot;ERROR&quot;</span>
        <span class="n">CRITICAL</span> <span class="o">=</span> <span class="s2">&quot;CRITICAL&quot;</span>

<span class="k">class</span><span class="w"> </span><span class="nc">ToastNotification</span><span class="p">(</span><span class="n">QWidget</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Widget de notification toast pour afficher des messages temporaires&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;INFO&quot;</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">message</span> <span class="o">=</span> <span class="n">message</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="n">level</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
        
        <span class="c1"># Configuration du widget</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setWindowFlags</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">FramelessWindowHint</span> <span class="o">|</span> <span class="n">Qt</span><span class="o">.</span><span class="n">WindowStaysOnTopHint</span> <span class="o">|</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Tool</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setAttribute</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">WA_TranslucentBackground</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setFixedSize</span><span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="mi">80</span><span class="p">)</span>
        
        <span class="c1"># Interface utilisateur</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setup_ui</span><span class="p">()</span>
        
        <span class="c1"># Animation de fondu</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opacity_effect</span> <span class="o">=</span> <span class="n">QGraphicsOpacityEffect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setGraphicsEffect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">opacity_effect</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">fade_in_animation</span> <span class="o">=</span> <span class="n">QPropertyAnimation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">opacity_effect</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&quot;opacity&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fade_in_animation</span><span class="o">.</span><span class="n">setDuration</span><span class="p">(</span><span class="mi">300</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fade_in_animation</span><span class="o">.</span><span class="n">setStartValue</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fade_in_animation</span><span class="o">.</span><span class="n">setEndValue</span><span class="p">(</span><span class="mf">0.9</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fade_in_animation</span><span class="o">.</span><span class="n">setEasingCurve</span><span class="p">(</span><span class="n">QEasingCurve</span><span class="o">.</span><span class="n">OutCubic</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fade_out_animation</span> <span class="o">=</span> <span class="n">QPropertyAnimation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">opacity_effect</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&quot;opacity&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fade_out_animation</span><span class="o">.</span><span class="n">setDuration</span><span class="p">(</span><span class="mi">300</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fade_out_animation</span><span class="o">.</span><span class="n">setStartValue</span><span class="p">(</span><span class="mf">0.9</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fade_out_animation</span><span class="o">.</span><span class="n">setEndValue</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fade_out_animation</span><span class="o">.</span><span class="n">setEasingCurve</span><span class="p">(</span><span class="n">QEasingCurve</span><span class="o">.</span><span class="n">InCubic</span><span class="p">)</span>
        
        <span class="c1"># Timer pour masquer automatiquement</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hide_timer</span> <span class="o">=</span> <span class="n">QTimer</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hide_timer</span><span class="o">.</span><span class="n">setSingleShot</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hide_timer</span><span class="o">.</span><span class="n">timeout</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hide_toast</span><span class="p">)</span>
        
        <span class="c1"># Connecter l&#39;animation de sortie à la fermeture</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fade_out_animation</span><span class="o">.</span><span class="n">finished</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_setup_ui</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Configure l&#39;interface utilisateur du toast&quot;&quot;&quot;</span>
        <span class="n">layout</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">setContentsMargins</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        
        <span class="c1"># Label pour le message</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">message_label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">message</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">message_label</span><span class="o">.</span><span class="n">setWordWrap</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        
        <span class="c1"># Style selon le niveau</span>
        <span class="n">styles</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;INFO&quot;</span><span class="p">:</span> <span class="s2">&quot;background-color: #2196F3; color: white; border-radius: 5px; padding: 10px;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;WARNING&quot;</span><span class="p">:</span> <span class="s2">&quot;background-color: #FF9800; color: white; border-radius: 5px; padding: 10px;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ERROR&quot;</span><span class="p">:</span> <span class="s2">&quot;background-color: #F44336; color: white; border-radius: 5px; padding: 10px;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;CRITICAL&quot;</span><span class="p">:</span> <span class="s2">&quot;background-color: #9C27B0; color: white; border-radius: 5px; padding: 10px;&quot;</span>
        <span class="p">}</span>
        
        <span class="n">style</span> <span class="o">=</span> <span class="n">styles</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="p">,</span> <span class="n">styles</span><span class="p">[</span><span class="s2">&quot;INFO&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">message_label</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="n">style</span><span class="p">)</span>
        
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">message_label</span><span class="p">)</span>
        
    <span class="k">def</span><span class="w"> </span><span class="nf">show_toast</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">duration</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5000</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Affiche le toast avec une animation de fondu&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fade_in_animation</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hide_timer</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">duration</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Toast affiché: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">hide_toast</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Masque le toast avec une animation de fondu&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hide_timer</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fade_out_animation</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Toast masqué: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


<div class="viewcode-block" id="ViewManager">
<a class="viewcode-back" href="../../../api/gui.html#hrneowave.gui.controllers.main_controller.ViewManager">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">ViewManager</span><span class="p">(</span><span class="n">QObject</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Gestionnaire de vues pour l&#39;application CHNeoWave&quot;&quot;&quot;</span>
        
        <span class="c1"># Signaux de classe</span>
        <span class="n">view_changed</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
        <span class="n">error_displayed</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">(</span><span class="nb">object</span><span class="p">)</span>
        
        <span class="c1"># Signaux pour le workflow</span>
        <span class="n">projectSelected</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
        <span class="n">calibrationFinished</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>
        <span class="n">acquisitionFinished</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>
        <span class="n">analysisFinished</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>
        <span class="n">exportFinished</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
        
<div class="viewcode-block" id="ViewManager.__init__">
<a class="viewcode-back" href="../../../api/gui.html#hrneowave.gui.controllers.main_controller.ViewManager.__init__">[docs]</a>
        <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stacked_widget</span><span class="p">:</span> <span class="n">QStackedWidget</span><span class="p">):</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stacked_widget</span> <span class="o">=</span> <span class="n">stacked_widget</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">views</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">QWidget</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_view</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            
            <span class="c1"># Gestion des toasts</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">active_toasts</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_toasts</span> <span class="o">=</span> <span class="mi">3</span>
            
            <span class="c1"># Bus d&#39;erreurs unifié (optionnel)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error_bus</span> <span class="o">=</span> <span class="kc">None</span>
            
            <span class="c1"># Connecter aux signaux unifiés si disponibles</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_connect_unified_signals</span><span class="p">()</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;ViewManager initialisé&quot;</span><span class="p">)</span></div>

        
<div class="viewcode-block" id="ViewManager.register_view">
<a class="viewcode-back" href="../../../api/gui.html#hrneowave.gui.controllers.main_controller.ViewManager.register_view">[docs]</a>
        <span class="k">def</span><span class="w"> </span><span class="nf">register_view</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">widget</span><span class="p">:</span> <span class="n">QWidget</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Enregistre une vue dans le gestionnaire&quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">views</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Vue &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; déjà enregistrée, remplacement&quot;</span><span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">views</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">widget</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stacked_widget</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span></div>


        <span class="nd">@Slot</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">change_view_by_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Slot public pour changer de vue par son nom.&quot;&quot;&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">change_view</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

<div class="viewcode-block" id="ViewManager.change_view">
<a class="viewcode-back" href="../../../api/gui.html#hrneowave.gui.controllers.main_controller.ViewManager.change_view">[docs]</a>
        <span class="k">def</span><span class="w"> </span><span class="nf">change_view</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Change la vue affichée dans le QStackedWidget&quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">views</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Tentative d&#39;affichage d&#39;une vue non enregistrée: </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span>

            <span class="n">widget_to_show</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">views</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stacked_widget</span><span class="o">.</span><span class="n">setCurrentWidget</span><span class="p">(</span><span class="n">widget_to_show</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_view</span> <span class="o">=</span> <span class="n">name</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">view_changed</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[NAV SUCCESS] Navigation réussie: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">current_view</span><span class="si">}</span><span class="s2"> → </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Vue &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; enregistrée&quot;</span><span class="p">)</span></div>

        
        <span class="k">def</span><span class="w"> </span><span class="nf">_connect_unified_signals</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Connecte aux signaux unifiés si disponibles&quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">UNIFIED_SIGNALS_AVAILABLE</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Signaux unifiés non disponibles&quot;</span><span class="p">)</span>
                <span class="k">return</span>
            
            <span class="k">try</span><span class="p">:</span>
                <span class="kn">from</span><span class="w"> </span><span class="nn">hrneowave.core.unified_signals</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_unified_signals</span>
                <span class="n">unified_signals</span> <span class="o">=</span> <span class="n">get_unified_signals</span><span class="p">()</span>
                
                <span class="k">if</span> <span class="n">unified_signals</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">unified_signals</span><span class="p">,</span> <span class="s1">&#39;error_bus&#39;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">error_bus</span> <span class="o">=</span> <span class="n">unified_signals</span><span class="o">.</span><span class="n">error_bus</span>
                    <span class="c1"># Connecter aux signaux d&#39;erreur pour afficher les toasts</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">error_bus</span><span class="p">,</span> <span class="s1">&#39;error_occurred&#39;</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">error_bus</span><span class="o">.</span><span class="n">error_occurred</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">show_error_toast</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">error_bus</span><span class="p">,</span> <span class="s1">&#39;warning_occurred&#39;</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">error_bus</span><span class="o">.</span><span class="n">warning_occurred</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">show_error_toast</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">error_bus</span><span class="p">,</span> <span class="s1">&#39;info_occurred&#39;</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">error_bus</span><span class="o">.</span><span class="n">info_occurred</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">show_error_toast</span><span class="p">)</span>
                    
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Connecté au bus d&#39;erreurs unifié&quot;</span><span class="p">)</span>
                
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Impossible de se connecter aux signaux unifiés: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Signaux unifiés connectés au ViewManager&quot;</span><span class="p">)</span>
        
<div class="viewcode-block" id="ViewManager.display_error_toast">
<a class="viewcode-back" href="../../../api/gui.html#hrneowave.gui.controllers.main_controller.ViewManager.display_error_toast">[docs]</a>
        <span class="k">def</span><span class="w"> </span><span class="nf">display_error_toast</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">error_msg</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Affiche un toast de notification pour une erreur&quot;&quot;&quot;</span>
            <span class="c1"># Vérifier que QApplication existe avant de créer des widgets</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">QApplication</span><span class="o">.</span><span class="n">instance</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;QApplication non disponible, impossible d&#39;afficher le toast&quot;</span><span class="p">)</span>
                <span class="k">return</span>
            
            <span class="c1"># Créer la classe ToastNotification si nécessaire</span>
            <span class="k">global</span> <span class="n">ToastNotification</span>
            <span class="k">if</span> <span class="n">ToastNotification</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ToastNotification</span> <span class="o">=</span> <span class="n">_create_toast_notification_class</span><span class="p">()</span>
            
            <span class="c1"># Limiter le nombre de toasts affichés simultanément</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">active_toasts</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_toasts</span><span class="p">:</span>
                <span class="n">oldest_toast</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_toasts</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">oldest_toast</span><span class="o">.</span><span class="n">hide_toast</span><span class="p">()</span>
            
            <span class="n">toast</span> <span class="o">=</span> <span class="n">ToastNotification</span><span class="p">(</span><span class="n">error_msg</span><span class="o">.</span><span class="n">message</span><span class="p">,</span> <span class="n">error_msg</span><span class="o">.</span><span class="n">level</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stacked_widget</span><span class="o">.</span><span class="n">parent</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">active_toasts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">toast</span><span class="p">)</span>
            <span class="n">toast</span><span class="o">.</span><span class="n">show_toast</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error_displayed</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span>
            
            <span class="c1"># Nettoyer la liste des toasts lorsque l&#39;animation est terminée</span>
            <span class="n">toast</span><span class="o">.</span><span class="n">fade_out_animation</span><span class="o">.</span><span class="n">finished</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remove_toast</span><span class="p">(</span><span class="n">toast</span><span class="p">))</span></div>

        
        <span class="k">def</span><span class="w"> </span><span class="nf">_remove_toast</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">toast</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Supprime un toast de la liste active&quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="n">toast</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_toasts</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">active_toasts</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">toast</span><span class="p">)</span>
        
<div class="viewcode-block" id="ViewManager.switch_to_view">
<a class="viewcode-back" href="../../../api/gui.html#hrneowave.gui.controllers.main_controller.ViewManager.switch_to_view">[docs]</a>
        <span class="k">def</span><span class="w"> </span><span class="nf">switch_to_view</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">view_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Change vers la vue spécifiée&quot;&quot;&quot;</span>
            <span class="c1"># 🔍 TRAÇAGE FIN - Ajouté pour diagnostic navigation</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[NAV] </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">current_view</span><span class="si">}</span><span class="s2"> → </span><span class="si">{</span><span class="n">view_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">view_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">views</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Vue &#39;</span><span class="si">{</span><span class="n">view_name</span><span class="si">}</span><span class="s2">&#39; non trouvée&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[NAV ERROR] Vue &#39;</span><span class="si">{</span><span class="n">view_name</span><span class="si">}</span><span class="s2">&#39; non trouvée dans </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">views</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">error_bus</span> <span class="ow">and</span> <span class="n">UNIFIED_SIGNALS_AVAILABLE</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">error_bus</span><span class="o">.</span><span class="n">emit_error</span><span class="p">(</span>
                        <span class="n">ErrorLevel</span><span class="o">.</span><span class="n">ERROR</span><span class="p">,</span>
                        <span class="sa">f</span><span class="s2">&quot;Vue &#39;</span><span class="si">{</span><span class="n">view_name</span><span class="si">}</span><span class="s2">&#39; non trouvée&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;ViewManager&quot;</span>
                    <span class="p">)</span>
                <span class="k">return</span> <span class="kc">False</span>
            
            <span class="c1"># Vérifications de sécurité pour éviter les violations d&#39;accès</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">stacked_widget</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;StackedWidget non initialisé&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">False</span>
                
            <span class="k">try</span><span class="p">:</span>
                <span class="n">widget</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">views</span><span class="p">[</span><span class="n">view_name</span><span class="p">]</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">widget</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Widget pour la vue &#39;</span><span class="si">{</span><span class="n">view_name</span><span class="si">}</span><span class="s2">&#39; est None&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="kc">False</span>
                    
                <span class="n">previous_view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_view</span>
                
                <span class="c1"># Vérifier que le widget est valide avant de l&#39;utiliser</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="s1">&#39;isValid&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">widget</span><span class="o">.</span><span class="n">isValid</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Widget pour la vue &#39;</span><span class="si">{</span><span class="n">view_name</span><span class="si">}</span><span class="s2">&#39; n&#39;est pas valide&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="kc">False</span>
                    
                <span class="bp">self</span><span class="o">.</span><span class="n">stacked_widget</span><span class="o">.</span><span class="n">setCurrentWidget</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">current_view</span> <span class="o">=</span> <span class="n">view_name</span>
                
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[NAV SUCCESS] Navigation réussie: </span><span class="si">{</span><span class="n">previous_view</span><span class="si">}</span><span class="s2"> → </span><span class="si">{</span><span class="n">view_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                
                <span class="bp">self</span><span class="o">.</span><span class="n">view_changed</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">view_name</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Changement vers la vue &#39;</span><span class="si">{</span><span class="n">view_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
                
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">error_bus</span> <span class="ow">and</span> <span class="n">UNIFIED_SIGNALS_AVAILABLE</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">error_bus</span><span class="o">.</span><span class="n">emit_info</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Changement vers la vue &#39;</span><span class="si">{</span><span class="n">view_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;ViewManager&quot;</span><span class="p">,</span>
                        <span class="p">{</span><span class="s1">&#39;previous_view&#39;</span><span class="p">:</span> <span class="n">previous_view</span><span class="p">}</span>
                    <span class="p">)</span>
                
                <span class="k">return</span> <span class="kc">True</span>
            
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Erreur lors du changement de vue: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[NAV EXCEPTION] Erreur lors du changement de vue: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">error_bus</span> <span class="ow">and</span> <span class="n">UNIFIED_SIGNALS_AVAILABLE</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">error_bus</span><span class="o">.</span><span class="n">emit_error</span><span class="p">(</span>
                        <span class="n">ErrorLevel</span><span class="o">.</span><span class="n">ERROR</span><span class="p">,</span>
                        <span class="sa">f</span><span class="s2">&quot;Erreur lors du changement de vue: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;ViewManager&quot;</span><span class="p">,</span>
                        <span class="n">exception</span><span class="o">=</span><span class="n">e</span>
                    <span class="p">)</span>
                <span class="k">return</span> <span class="kc">False</span></div>

        
<div class="viewcode-block" id="ViewManager.get_current_view">
<a class="viewcode-back" href="../../../api/gui.html#hrneowave.gui.controllers.main_controller.ViewManager.get_current_view">[docs]</a>
        <span class="k">def</span><span class="w"> </span><span class="nf">get_current_view</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Retourne le nom de la vue actuelle&quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_view</span></div>

        
<div class="viewcode-block" id="ViewManager.get_view_widget">
<a class="viewcode-back" href="../../../api/gui.html#hrneowave.gui.controllers.main_controller.ViewManager.get_view_widget">[docs]</a>
        <span class="k">def</span><span class="w"> </span><span class="nf">get_view_widget</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">view_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Retourne le widget d&#39;une vue&quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">views</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">view_name</span><span class="p">)</span></div>

        
<div class="viewcode-block" id="ViewManager.has_view">
<a class="viewcode-back" href="../../../api/gui.html#hrneowave.gui.controllers.main_controller.ViewManager.has_view">[docs]</a>
        <span class="k">def</span><span class="w"> </span><span class="nf">has_view</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">view_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Vérifie si une vue est enregistrée&quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="n">view_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">views</span></div>

        
<div class="viewcode-block" id="ViewManager.show_error_toast">
<a class="viewcode-back" href="../../../api/gui.html#hrneowave.gui.controllers.main_controller.ViewManager.show_error_toast">[docs]</a>
        <span class="k">def</span><span class="w"> </span><span class="nf">show_error_toast</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">error_msg</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Affiche un toast d&#39;erreur&quot;&quot;&quot;</span>
            <span class="c1"># Vérifier que QApplication existe avant de créer des widgets</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">QApplication</span><span class="o">.</span><span class="n">instance</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;QApplication non disponible, impossible d&#39;afficher le toast&quot;</span><span class="p">)</span>
                <span class="k">return</span>
            
            <span class="c1"># Vérifier que le stacked_widget existe et a un parent</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">stacked_widget</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">stacked_widget</span><span class="o">.</span><span class="n">parent</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Stacked widget non disponible, impossible d&#39;afficher le toast&quot;</span><span class="p">)</span>
                <span class="k">return</span>
            
            <span class="c1"># Limiter le nombre de toasts actifs</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">active_toasts</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_toasts</span><span class="p">:</span>
                <span class="c1"># Fermer le plus ancien</span>
                <span class="n">oldest_toast</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_toasts</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">oldest_toast</span><span class="o">.</span><span class="n">hide_toast</span><span class="p">()</span>
            
            <span class="c1"># Créer la classe ToastNotification si nécessaire</span>
            <span class="k">global</span> <span class="n">ToastNotification</span>
            <span class="k">if</span> <span class="n">ToastNotification</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ToastNotification</span> <span class="o">=</span> <span class="n">_create_toast_notification_class</span><span class="p">()</span>
            
            <span class="c1"># Créer et afficher le nouveau toast</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">toast</span> <span class="o">=</span> <span class="n">ToastNotification</span><span class="p">(</span>
                    <span class="n">message</span><span class="o">=</span><span class="n">error_msg</span><span class="o">.</span><span class="n">message</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">error_msg</span><span class="p">,</span> <span class="s1">&#39;message&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="nb">str</span><span class="p">(</span><span class="n">error_msg</span><span class="p">),</span>
                    <span class="n">level</span><span class="o">=</span><span class="n">error_msg</span><span class="o">.</span><span class="n">level</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">error_msg</span><span class="p">,</span> <span class="s1">&#39;level&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="s1">&#39;INFO&#39;</span><span class="p">,</span>
                    <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stacked_widget</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span>
                <span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Erreur lors de la création du toast: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span>
            
            <span class="c1"># Positionner les toasts en cascade</span>
            <span class="n">toast_index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">active_toasts</span><span class="p">)</span>
            <span class="n">screen</span> <span class="o">=</span> <span class="n">QApplication</span><span class="o">.</span><span class="n">primaryScreen</span><span class="p">()</span>
            <span class="n">screen_rect</span> <span class="o">=</span> <span class="n">screen</span><span class="o">.</span><span class="n">availableGeometry</span><span class="p">()</span>
            
            <span class="n">x</span> <span class="o">=</span> <span class="n">screen_rect</span><span class="o">.</span><span class="n">width</span><span class="p">()</span> <span class="o">-</span> <span class="n">toast</span><span class="o">.</span><span class="n">width</span><span class="p">()</span> <span class="o">-</span> <span class="mi">20</span>
            <span class="n">y</span> <span class="o">=</span> <span class="mi">20</span> <span class="o">+</span> <span class="p">(</span><span class="n">toast_index</span> <span class="o">*</span> <span class="p">(</span><span class="n">toast</span><span class="o">.</span><span class="n">height</span><span class="p">()</span> <span class="o">+</span> <span class="mi">10</span><span class="p">))</span>
            <span class="n">toast</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
            
            <span class="c1"># Durée selon le niveau d&#39;erreur</span>
            <span class="k">if</span> <span class="n">UNIFIED_SIGNALS_AVAILABLE</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">error_msg</span><span class="p">,</span> <span class="s1">&#39;level&#39;</span><span class="p">):</span>
                <span class="n">durations</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="n">ErrorLevel</span><span class="o">.</span><span class="n">INFO</span><span class="p">:</span> <span class="mi">3000</span><span class="p">,</span>
                    <span class="n">ErrorLevel</span><span class="o">.</span><span class="n">WARNING</span><span class="p">:</span> <span class="mi">5000</span><span class="p">,</span>
                    <span class="n">ErrorLevel</span><span class="o">.</span><span class="n">ERROR</span><span class="p">:</span> <span class="mi">7000</span><span class="p">,</span>
                    <span class="n">ErrorLevel</span><span class="o">.</span><span class="n">CRITICAL</span><span class="p">:</span> <span class="mi">10000</span>
                <span class="p">}</span>
                <span class="n">duration</span> <span class="o">=</span> <span class="n">durations</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">error_msg</span><span class="o">.</span><span class="n">level</span><span class="p">,</span> <span class="mi">5000</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">duration</span> <span class="o">=</span> <span class="mi">5000</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">active_toasts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">toast</span><span class="p">)</span>
            <span class="n">toast</span><span class="o">.</span><span class="n">show_toast</span><span class="p">(</span><span class="n">duration</span><span class="p">)</span>
            
            <span class="c1"># Nettoyer la liste quand le toast se ferme</span>
            <span class="k">def</span><span class="w"> </span><span class="nf">cleanup_toast</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">toast</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_toasts</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">active_toasts</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">toast</span><span class="p">)</span>
            
            <span class="n">toast</span><span class="o">.</span><span class="n">fade_out_animation</span><span class="o">.</span><span class="n">finished</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">cleanup_toast</span><span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">error_displayed</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span>
            <span class="n">level_str</span> <span class="o">=</span> <span class="n">error_msg</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">value</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">error_msg</span><span class="p">,</span> <span class="s1">&#39;level&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">error_msg</span><span class="o">.</span><span class="n">level</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="nb">str</span><span class="p">(</span><span class="n">error_msg</span><span class="o">.</span><span class="n">level</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">error_msg</span><span class="p">,</span> <span class="s1">&#39;level&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="s1">&#39;INFO&#39;</span><span class="p">)</span>
            <span class="n">message_str</span> <span class="o">=</span> <span class="n">error_msg</span><span class="o">.</span><span class="n">message</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">error_msg</span><span class="p">,</span> <span class="s1">&#39;message&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="nb">str</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Toast affiché: </span><span class="si">{</span><span class="n">level_str</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">message_str</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>

        
        <span class="k">def</span><span class="w"> </span><span class="nf">_on_session_finished</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;P0: Gestionnaire pour sessionFinished() - change automatiquement vers AnalysisView&quot;&quot;&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Session terminée, changement automatique vers AnalysisView&quot;</span><span class="p">)</span>
            
            <span class="c1"># P0: AnalysisView apparaît quand sessionFinished est reçu</span>
            <span class="n">QTimer</span><span class="o">.</span><span class="n">singleShot</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">switch_to_view</span><span class="p">(</span><span class="s2">&quot;AnalysisView&quot;</span><span class="p">))</span>
            
            <span class="c1"># Afficher une notification de succès</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">error_bus</span> <span class="ow">and</span> <span class="n">UNIFIED_SIGNALS_AVAILABLE</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">error_bus</span><span class="o">.</span><span class="n">emit_info</span><span class="p">(</span>
                    <span class="s2">&quot;Session d&#39;acquisition terminée&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;ViewManager&quot;</span>
                <span class="p">)</span>
        
<div class="viewcode-block" id="ViewManager.cleanup_toasts">
<a class="viewcode-back" href="../../../api/gui.html#hrneowave.gui.controllers.main_controller.ViewManager.cleanup_toasts">[docs]</a>
        <span class="k">def</span><span class="w"> </span><span class="nf">cleanup_toasts</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Nettoie tous les toasts actifs&quot;&quot;&quot;</span>
            <span class="k">for</span> <span class="n">toast</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_toasts</span><span class="p">:</span>
                <span class="n">toast</span><span class="o">.</span><span class="n">hide_toast</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">active_toasts</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Tous les toasts ont été nettoyés&quot;</span><span class="p">)</span></div>
</div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Droits d'auteur 2024, Laboratoire d&#39;Études Maritimes.</p>
  </div>

  Compilé avec <a href="https://www.sphinx-doc.org/">Sphinx</a> en utilisant un
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">thème</a>
    fourni par <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>