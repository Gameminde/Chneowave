

<!DOCTYPE html>
<html class="writer-html5" lang="fr" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Guide Technique CHNeoWave &mdash; Documentation CHNeoWave 1.0.0</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="_static/custom.css" />
      <link rel="stylesheet" type="text/css" href="_static/custom.css" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=05dadb3a"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="_static/translations.js?v=e6b791cb"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Recherche" href="search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #2980B9" >

          
          
          <a href="index.html" class="icon icon-home">
            CHNeoWave
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Rechercher docs" aria-label="Rechercher docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Référence API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="api/core.html">Module Core</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/gui.html">Module GUI</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/data.html">Module Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/utils.html">Module Utils</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #2980B9" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">CHNeoWave</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Guide Technique CHNeoWave</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/laboratoire-maritime/chneowave/blob/main/docs/technical_guide.rst" class="fa fa-github"> Éditer sur GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="guide-technique-chneowave">
<h1>Guide Technique CHNeoWave<a class="headerlink" href="#guide-technique-chneowave" title="Lien vers cette rubrique"></a></h1>
<p>Ce guide technique s’adresse aux développeurs, intégrateurs et administrateurs système travaillant avec CHNeoWave.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Pour l’utilisation standard du logiciel, consultez le <a class="reference internal" href="user_guide.html"><span class="doc">Guide Utilisateur CHNeoWave</span></a>.</p>
</div>
<section id="architecture-systeme">
<h2>Architecture Système<a class="headerlink" href="#architecture-systeme" title="Lien vers cette rubrique"></a></h2>
<section id="vue-d-ensemble">
<h3>Vue d’Ensemble<a class="headerlink" href="#vue-d-ensemble" title="Lien vers cette rubrique"></a></h3>
<p>CHNeoWave suit une architecture MVC (Model-View-Controller) modulaire :</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>CHNeoWave/
├── src/hrneowave/
│   ├── core/           # Noyau système
│   ├── data/           # Gestion des données
│   ├── analysis/       # Moteurs d&#39;analyse
│   ├── gui/            # Interface utilisateur
│   └── utils/          # Utilitaires
├── tests/              # Tests automatisés
├── docs/               # Documentation
├── config/             # Configuration
└── scripts/            # Scripts utilitaires
</pre></div>
</div>
</section>
<section id="composants-principaux">
<h3>Composants Principaux<a class="headerlink" href="#composants-principaux" title="Lien vers cette rubrique"></a></h3>
<p><strong>Core (Noyau)</strong></p>
<ul class="simple">
<li><p><strong>ErrorHandler</strong> : Gestion centralisée des erreurs</p></li>
<li><p><strong>PerformanceMonitor</strong> : Monitoring des performances</p></li>
<li><p><strong>ConfigManager</strong> : Gestion de la configuration</p></li>
<li><p><strong>ValidationEngine</strong> : Validation des données</p></li>
</ul>
<p><strong>Data (Données)</strong></p>
<ul class="simple">
<li><p><strong>AcquisitionManager</strong> : Acquisition temps réel</p></li>
<li><p><strong>DataProcessor</strong> : Traitement des données</p></li>
<li><p><strong>StorageManager</strong> : Persistance HDF5</p></li>
<li><p><strong>ExportEngine</strong> : Export multi-formats</p></li>
</ul>
<p><strong>Analysis (Analyse)</strong></p>
<ul class="simple">
<li><p><strong>SpectralAnalyzer</strong> : Analyse fréquentielle</p></li>
<li><p><strong>WaveAnalyzer</strong> : Analyse de houle</p></li>
<li><p><strong>StatisticalAnalyzer</strong> : Analyse statistique</p></li>
<li><p><strong>QualityAnalyzer</strong> : Contrôle qualité</p></li>
</ul>
<p><strong>GUI (Interface)</strong></p>
<ul class="simple">
<li><p><strong>MainController</strong> : Contrôleur principal</p></li>
<li><p><strong>ViewManager</strong> : Gestion des vues</p></li>
<li><p><strong>WorkflowManager</strong> : Orchestration des workflows</p></li>
<li><p><strong>ThemeManager</strong> : Gestion des thèmes</p></li>
</ul>
</section>
<section id="patterns-de-conception">
<h3>Patterns de Conception<a class="headerlink" href="#patterns-de-conception" title="Lien vers cette rubrique"></a></h3>
<p><strong>Singleton</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">ConfigManager</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Gestionnaire de configuration (Singleton).&quot;&quot;&quot;</span>
    <span class="n">_instance</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">_initialized</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_instance</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">_instance</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_instance</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_initialized</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_config</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_initialized</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
<p><strong>Observer</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">SignalBus</span><span class="p">(</span><span class="n">QObject</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Bus de signaux pour communication inter-composants.&quot;&quot;&quot;</span>

    <span class="c1"># Signaux d&#39;acquisition</span>
    <span class="n">acquisition_started</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">()</span>
    <span class="n">acquisition_stopped</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">()</span>
    <span class="n">data_received</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">(</span><span class="nb">object</span><span class="p">)</span>

    <span class="c1"># Signaux d&#39;analyse</span>
    <span class="n">analysis_completed</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">object</span><span class="p">)</span>
    <span class="n">analysis_failed</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>

    <span class="c1"># Signaux d&#39;interface</span>
    <span class="n">view_changed</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="n">theme_changed</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Factory</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">AnalyzerFactory</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Factory pour créer les analyseurs.&quot;&quot;&quot;</span>

    <span class="n">_analyzers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;spectral&#39;</span><span class="p">:</span> <span class="n">SpectralAnalyzer</span><span class="p">,</span>
        <span class="s1">&#39;wave&#39;</span><span class="p">:</span> <span class="n">WaveAnalyzer</span><span class="p">,</span>
        <span class="s1">&#39;statistical&#39;</span><span class="p">:</span> <span class="n">StatisticalAnalyzer</span><span class="p">,</span>
        <span class="s1">&#39;quality&#39;</span><span class="p">:</span> <span class="n">QualityAnalyzer</span>
    <span class="p">}</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">create_analyzer</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">analyzer_type</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">analyzer_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_analyzers</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Analyseur inconnu: </span><span class="si">{</span><span class="n">analyzer_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">analyzer_class</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_analyzers</span><span class="p">[</span><span class="n">analyzer_type</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">analyzer_class</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Strategy</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">DataProcessor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Processeur de données avec stratégies configurables.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_strategies</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;filtering&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s1">&#39;detrending&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s1">&#39;windowing&#39;</span><span class="p">:</span> <span class="kc">None</span>
        <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">set_strategy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">strategy_type</span><span class="p">,</span> <span class="n">strategy</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_strategies</span><span class="p">[</span><span class="n">strategy_type</span><span class="p">]</span> <span class="o">=</span> <span class="n">strategy</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">strategy</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_strategies</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">strategy</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">strategy</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">data</span>
</pre></div>
</div>
</section>
</section>
<section id="gestion-des-donnees">
<h2>Gestion des Données<a class="headerlink" href="#gestion-des-donnees" title="Lien vers cette rubrique"></a></h2>
<section id="format-hdf5">
<h3>Format HDF5<a class="headerlink" href="#format-hdf5" title="Lien vers cette rubrique"></a></h3>
<p><strong>Structure des fichiers :</strong></p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>acquisition_001.h5
├── /metadata
│   ├── acquisition_info
│   ├── sensor_config
│   └── processing_history
├── /raw_data
│   ├── channel_1
│   ├── channel_2
│   └── timestamps
├── /processed_data
│   ├── filtered
│   ├── calibrated
│   └── quality_flags
└── /analysis_results
    ├── spectral
    ├── wave_statistics
    └── quality_metrics
</pre></div>
</div>
<p><strong>Implémentation :</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">h5py</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>

<span class="k">class</span><span class="w"> </span><span class="nc">HDF5Manager</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Gestionnaire de fichiers HDF5.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">mode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_file</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_file</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_val</span><span class="p">,</span> <span class="n">exc_tb</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">save_acquisition_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">metadata</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sauvegarde des données d&#39;acquisition.&quot;&quot;&quot;</span>

        <span class="c1"># Métadonnées</span>
        <span class="n">meta_group</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s1">&#39;metadata&#39;</span><span class="p">)</span>
        <span class="n">meta_group</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;acquisition_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
        <span class="n">meta_group</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;sampling_rate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;sampling_rate&#39;</span><span class="p">]</span>
        <span class="n">meta_group</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;duration&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;duration&#39;</span><span class="p">]</span>
        <span class="n">meta_group</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;channels&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;channels&#39;</span><span class="p">]</span>

        <span class="c1"># Données brutes</span>
        <span class="n">raw_group</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s1">&#39;raw_data&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">channel_data</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
            <span class="n">dataset</span> <span class="o">=</span> <span class="n">raw_group</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;channel_</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                <span class="n">data</span><span class="o">=</span><span class="n">channel_data</span><span class="p">,</span>
                <span class="n">compression</span><span class="o">=</span><span class="s1">&#39;gzip&#39;</span><span class="p">,</span>
                <span class="n">compression_opts</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span>
                <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">fletcher32</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>
            <span class="n">dataset</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;units&#39;</span><span class="p">,</span> <span class="s1">&#39;mm&#39;</span><span class="p">)</span>
            <span class="n">dataset</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;calibration_factor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cal_factor&#39;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

        <span class="c1"># Timestamps</span>
        <span class="n">timestamps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="o">/</span> <span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;sampling_rate&#39;</span><span class="p">]</span>
        <span class="n">raw_group</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span>
            <span class="s1">&#39;timestamps&#39;</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="n">timestamps</span><span class="p">,</span>
            <span class="n">compression</span><span class="o">=</span><span class="s1">&#39;gzip&#39;</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">load_acquisition_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Chargement des données d&#39;acquisition.&quot;&quot;&quot;</span>

        <span class="c1"># Métadonnées</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="p">[</span><span class="s1">&#39;metadata&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">)</span>

        <span class="c1"># Données</span>
        <span class="n">raw_group</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="p">[</span><span class="s1">&#39;raw_data&#39;</span><span class="p">]</span>
        <span class="n">channels</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">raw_group</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;channel_&#39;</span><span class="p">):</span>
                <span class="n">channels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">raw_group</span><span class="p">[</span><span class="n">key</span><span class="p">][:])</span>

        <span class="n">timestamps</span> <span class="o">=</span> <span class="n">raw_group</span><span class="p">[</span><span class="s1">&#39;timestamps&#39;</span><span class="p">][:]</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">channels</span><span class="p">),</span>
            <span class="s1">&#39;timestamps&#39;</span><span class="p">:</span> <span class="n">timestamps</span><span class="p">,</span>
            <span class="s1">&#39;metadata&#39;</span><span class="p">:</span> <span class="n">metadata</span>
        <span class="p">}</span>
</pre></div>
</div>
</section>
<section id="validation-des-donnees">
<h3>Validation des Données<a class="headerlink" href="#validation-des-donnees" title="Lien vers cette rubrique"></a></h3>
<p><strong>Système de validation :</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">abc</span><span class="w"> </span><span class="kn">import</span> <span class="n">ABC</span><span class="p">,</span> <span class="n">abstractmethod</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Any</span>

<span class="k">class</span><span class="w"> </span><span class="nc">ValidationRule</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Règle de validation abstraite.&quot;&quot;&quot;</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="k">pass</span>

<span class="k">class</span><span class="w"> </span><span class="nc">RangeValidationRule</span><span class="p">(</span><span class="n">ValidationRule</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validation de plage de valeurs.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">min_val</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">max_val</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_val</span> <span class="o">=</span> <span class="n">min_val</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_val</span> <span class="o">=</span> <span class="n">max_val</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="n">out_of_range</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_val</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">data</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_val</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;is_valid&#39;</span><span class="p">:</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">out_of_range</span><span class="p">),</span>
            <span class="s1">&#39;error_count&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">out_of_range</span><span class="p">),</span>
            <span class="s1">&#39;error_percentage&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">out_of_range</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span>
            <span class="s1">&#39;error_indices&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">out_of_range</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="p">}</span>

<span class="k">class</span><span class="w"> </span><span class="nc">SpikeDetectionRule</span><span class="p">(</span><span class="n">ValidationRule</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Détection de pics aberrants.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">3.0</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span> <span class="o">=</span> <span class="n">threshold</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="c1"># Détection par écart-type</span>
        <span class="n">mean_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">std_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="n">spikes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">data</span> <span class="o">-</span> <span class="n">mean_val</span><span class="p">)</span> <span class="o">&gt;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">threshold</span> <span class="o">*</span> <span class="n">std_val</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;is_valid&#39;</span><span class="p">:</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">spikes</span><span class="p">),</span>
            <span class="s1">&#39;spike_count&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">spikes</span><span class="p">),</span>
            <span class="s1">&#39;spike_percentage&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">spikes</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span>
            <span class="s1">&#39;spike_indices&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">spikes</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
            <span class="s1">&#39;threshold_used&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span> <span class="o">*</span> <span class="n">std_val</span>
        <span class="p">}</span>

<span class="k">class</span><span class="w"> </span><span class="nc">DataValidator</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validateur de données principal.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rules</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ValidationRule</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_rule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rule</span><span class="p">:</span> <span class="n">ValidationRule</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;overall_valid&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s1">&#39;rule_results&#39;</span><span class="p">:</span> <span class="p">{},</span>
            <span class="s1">&#39;summary&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;total_errors&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s1">&#39;error_types&#39;</span><span class="p">:</span> <span class="p">[]</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">rule</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rules</span><span class="p">):</span>
            <span class="n">rule_name</span> <span class="o">=</span> <span class="n">rule</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
            <span class="n">rule_result</span> <span class="o">=</span> <span class="n">rule</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

            <span class="n">results</span><span class="p">[</span><span class="s1">&#39;rule_results&#39;</span><span class="p">][</span><span class="n">rule_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">rule_result</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">rule_result</span><span class="p">[</span><span class="s1">&#39;is_valid&#39;</span><span class="p">]:</span>
                <span class="n">results</span><span class="p">[</span><span class="s1">&#39;overall_valid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">results</span><span class="p">[</span><span class="s1">&#39;summary&#39;</span><span class="p">][</span><span class="s1">&#39;total_errors&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">rule_result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;error_count&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">results</span><span class="p">[</span><span class="s1">&#39;summary&#39;</span><span class="p">][</span><span class="s1">&#39;error_types&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rule_name</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">results</span>
</pre></div>
</div>
</section>
</section>
<section id="acquisition-temps-reel">
<h2>Acquisition Temps Réel<a class="headerlink" href="#acquisition-temps-reel" title="Lien vers cette rubrique"></a></h2>
<section id="architecture-multi-thread">
<h3>Architecture Multi-Thread<a class="headerlink" href="#architecture-multi-thread" title="Lien vers cette rubrique"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">threading</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">queue</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">serial</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">PySide6.QtCore</span><span class="w"> </span><span class="kn">import</span> <span class="n">QThread</span><span class="p">,</span> <span class="n">Signal</span>

<span class="k">class</span><span class="w"> </span><span class="nc">AcquisitionThread</span><span class="p">(</span><span class="n">QThread</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Thread d&#39;acquisition de données.&quot;&quot;&quot;</span>

    <span class="n">data_received</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span>
    <span class="n">error_occurred</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="n">status_changed</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">running</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">paused</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Buffer circulaire</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">buffer_size</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;buffer_size&#39;</span><span class="p">,</span> <span class="mi">8192</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_buffer</span> <span class="o">=</span> <span class="n">queue</span><span class="o">.</span><span class="n">Queue</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">buffer_size</span><span class="p">)</span>

        <span class="c1"># Connexion série</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">serial_connection</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Boucle principale d&#39;acquisition.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_setup_serial_connection</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">running</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">status_changed</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s2">&quot;Acquisition démarrée&quot;</span><span class="p">)</span>

            <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">running</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">paused</span><span class="p">:</span>
                    <span class="n">data_point</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_data_point</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">data_point</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_process_data_point</span><span class="p">(</span><span class="n">data_point</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">msleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>  <span class="c1"># Pause courte</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error_occurred</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Erreur d&#39;acquisition: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cleanup</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">status_changed</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s2">&quot;Acquisition arrêtée&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_setup_serial_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Configuration de la connexion série.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">serial_connection</span> <span class="o">=</span> <span class="n">serial</span><span class="o">.</span><span class="n">Serial</span><span class="p">(</span>
            <span class="n">port</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;port&#39;</span><span class="p">],</span>
            <span class="n">baudrate</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;baudrate&#39;</span><span class="p">],</span>
            <span class="n">bytesize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;bytesize&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span>
            <span class="n">parity</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;parity&#39;</span><span class="p">,</span> <span class="s1">&#39;N&#39;</span><span class="p">),</span>
            <span class="n">stopbits</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;stopbits&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;timeout&#39;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_read_data_point</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Lecture d&#39;un point de données.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">serial_connection</span><span class="o">.</span><span class="n">in_waiting</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">serial_connection</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">UnicodeDecodeError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># Log de l&#39;erreur sans arrêter l&#39;acquisition</span>
            <span class="k">pass</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_process_data_point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_point</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Traitement d&#39;un point de données.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Ajout au buffer</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_buffer</span><span class="o">.</span><span class="n">full</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data_buffer</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">data_point</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Buffer plein, supprimer le plus ancien</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data_buffer</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data_buffer</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">data_point</span><span class="p">)</span>

            <span class="c1"># Émission du signal si buffer suffisant</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_buffer</span><span class="o">.</span><span class="n">qsize</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;emit_threshold&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">):</span>
                <span class="n">buffer_data</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">temp_queue</span> <span class="o">=</span> <span class="n">queue</span><span class="o">.</span><span class="n">Queue</span><span class="p">()</span>

                <span class="c1"># Extraction des données</span>
                <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_buffer</span><span class="o">.</span><span class="n">empty</span><span class="p">():</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_buffer</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
                    <span class="n">buffer_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                    <span class="n">temp_queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

                <span class="c1"># Remise en buffer</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data_buffer</span> <span class="o">=</span> <span class="n">temp_queue</span>

                <span class="c1"># Émission</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data_received</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">buffer_data</span><span class="p">))</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error_occurred</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Erreur de traitement: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">stop_acquisition</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Arrêt de l&#39;acquisition.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">running</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">pause_acquisition</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Pause de l&#39;acquisition.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">paused</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">resume_acquisition</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Reprise de l&#39;acquisition.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">paused</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_cleanup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Nettoyage des ressources.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">serial_connection</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">serial_connection</span><span class="o">.</span><span class="n">is_open</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">serial_connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="gestion-des-buffers">
<h3>Gestion des Buffers<a class="headerlink" href="#gestion-des-buffers" title="Lien vers cette rubrique"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">deque</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">threading</span>

<span class="k">class</span><span class="w"> </span><span class="nc">CircularBuffer</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Buffer circulaire thread-safe.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="n">size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">buffer</span> <span class="o">=</span> <span class="n">deque</span><span class="p">(</span><span class="n">maxlen</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">RLock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_full</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Ajout de données au buffer.&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
            <span class="n">was_full</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">buffer</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">buffer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">was_full</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_full</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">extend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_array</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Ajout de plusieurs données.&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">data_array</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_points</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Récupération des données.&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">n_points</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">buffer</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">buffer</span><span class="p">)[</span><span class="o">-</span><span class="n">n_points</span><span class="p">:])</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Vidage du buffer.&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">buffer</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_full</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">is_full</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Vérification si le buffer est plein.&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_full</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">buffer</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="analyse-en-temps-reel">
<h3>Analyse en Temps Réel<a class="headerlink" href="#analyse-en-temps-reel" title="Lien vers cette rubrique"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">RealTimeAnalyzer</span><span class="p">(</span><span class="n">QThread</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Analyseur temps réel.&quot;&quot;&quot;</span>

    <span class="n">analysis_ready</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">buffer</span> <span class="o">=</span> <span class="n">buffer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">running</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Paramètres d&#39;analyse</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;window_size&#39;</span><span class="p">,</span> <span class="mi">1024</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">overlap</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;overlap&#39;</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_rate</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;update_rate&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>  <span class="c1"># Hz</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Boucle d&#39;analyse temps réel.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">running</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">running</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">buffer</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span><span class="p">:</span>
                <span class="c1"># Extraction des données</span>
                <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">buffer</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">window_size</span><span class="p">)</span>

                <span class="c1"># Analyse rapide</span>
                <span class="n">analysis_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_quick_analysis</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

                <span class="c1"># Émission du résultat</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">analysis_ready</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">analysis_result</span><span class="p">)</span>

            <span class="c1"># Attente selon le taux de mise à jour</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">msleep</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="mi">1000</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_rate</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_quick_analysis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Analyse rapide pour temps réel.&quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">(),</span>
            <span class="s1">&#39;statistics&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;mean&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data</span><span class="p">),</span>
                <span class="s1">&#39;std&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">data</span><span class="p">),</span>
                <span class="s1">&#39;min&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">data</span><span class="p">),</span>
                <span class="s1">&#39;max&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">data</span><span class="p">),</span>
                <span class="s1">&#39;rms&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1"># FFT rapide</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">256</span><span class="p">:</span>  <span class="c1"># Minimum pour FFT</span>
            <span class="n">fft_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">freqs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftfreq</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="mi">1</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;sampling_rate&#39;</span><span class="p">])</span>

            <span class="c1"># Pic de fréquence</span>
            <span class="n">magnitude</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">fft_data</span><span class="p">)</span>
            <span class="n">peak_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">magnitude</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">magnitude</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">peak_freq</span> <span class="o">=</span> <span class="n">freqs</span><span class="p">[</span><span class="n">peak_idx</span><span class="p">]</span>

            <span class="n">result</span><span class="p">[</span><span class="s1">&#39;spectral&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;peak_frequency&#39;</span><span class="p">:</span> <span class="n">peak_freq</span><span class="p">,</span>
                <span class="s1">&#39;peak_amplitude&#39;</span><span class="p">:</span> <span class="n">magnitude</span><span class="p">[</span><span class="n">peak_idx</span><span class="p">],</span>
                <span class="s1">&#39;total_power&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">magnitude</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="p">}</span>

        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Arrêt de l&#39;analyseur.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">running</span> <span class="o">=</span> <span class="kc">False</span>
</pre></div>
</div>
</section>
</section>
<section id="interface-utilisateur">
<h2>Interface Utilisateur<a class="headerlink" href="#interface-utilisateur" title="Lien vers cette rubrique"></a></h2>
<section id="architecture-mvc">
<h3>Architecture MVC<a class="headerlink" href="#architecture-mvc" title="Lien vers cette rubrique"></a></h3>
<p><strong>Contrôleur Principal :</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">PySide6.QtWidgets</span><span class="w"> </span><span class="kn">import</span> <span class="n">QApplication</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">PySide6.QtCore</span><span class="w"> </span><span class="kn">import</span> <span class="n">QObject</span><span class="p">,</span> <span class="n">Signal</span>

<span class="k">class</span><span class="w"> </span><span class="nc">MainController</span><span class="p">(</span><span class="n">QObject</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Contrôleur principal de l&#39;application.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="c1"># Gestionnaires</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view_manager</span> <span class="o">=</span> <span class="n">ViewManager</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">workflow_manager</span> <span class="o">=</span> <span class="n">WorkflowManager</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_manager</span> <span class="o">=</span> <span class="n">DataManager</span><span class="p">()</span>

        <span class="c1"># Bus de signaux</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">signal_bus</span> <span class="o">=</span> <span class="n">SignalBus</span><span class="p">()</span>

        <span class="c1"># Connexions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setup_connections</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_setup_connections</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Configuration des connexions de signaux.&quot;&quot;&quot;</span>

        <span class="c1"># Signaux d&#39;acquisition</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">signal_bus</span><span class="o">.</span><span class="n">acquisition_started</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">view_manager</span><span class="o">.</span><span class="n">on_acquisition_started</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">signal_bus</span><span class="o">.</span><span class="n">data_received</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_manager</span><span class="o">.</span><span class="n">on_data_received</span>
        <span class="p">)</span>

        <span class="c1"># Signaux d&#39;analyse</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">signal_bus</span><span class="o">.</span><span class="n">analysis_completed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">view_manager</span><span class="o">.</span><span class="n">on_analysis_completed</span>
        <span class="p">)</span>

        <span class="c1"># Signaux d&#39;interface</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">signal_bus</span><span class="o">.</span><span class="n">view_changed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">view_manager</span><span class="o">.</span><span class="n">change_view</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">start_application</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Démarrage de l&#39;application.&quot;&quot;&quot;</span>

        <span class="c1"># Initialisation des composants</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view_manager</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">workflow_manager</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_manager</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>

        <span class="c1"># Affichage de la vue principale</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view_manager</span><span class="o">.</span><span class="n">show_main_window</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">shutdown_application</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Arrêt propre de l&#39;application.&quot;&quot;&quot;</span>

        <span class="c1"># Arrêt des acquisitions en cours</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">workflow_manager</span><span class="o">.</span><span class="n">stop_all_workflows</span><span class="p">()</span>

        <span class="c1"># Sauvegarde des données</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_manager</span><span class="o">.</span><span class="n">save_pending_data</span><span class="p">()</span>

        <span class="c1"># Nettoyage des ressources</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view_manager</span><span class="o">.</span><span class="n">cleanup</span><span class="p">()</span>
</pre></div>
</div>
<p><strong>Gestionnaire de Vues :</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">PySide6.QtWidgets</span><span class="w"> </span><span class="kn">import</span> <span class="n">QMainWindow</span><span class="p">,</span> <span class="n">QStackedWidget</span>

<span class="k">class</span><span class="w"> </span><span class="nc">ViewManager</span><span class="p">(</span><span class="n">QObject</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Gestionnaire des vues de l&#39;interface.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stacked_widget</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">views</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Thème</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">theme_manager</span> <span class="o">=</span> <span class="n">ThemeManager</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialisation du gestionnaire de vues.&quot;&quot;&quot;</span>

        <span class="c1"># Fenêtre principale</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span> <span class="o">=</span> <span class="n">MainWindow</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stacked_widget</span> <span class="o">=</span> <span class="n">QStackedWidget</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">setCentralWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stacked_widget</span><span class="p">)</span>

        <span class="c1"># Création des vues</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_create_views</span><span class="p">()</span>

        <span class="c1"># Application du thème</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">theme_manager</span><span class="o">.</span><span class="n">apply_theme</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_create_views</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Création des vues de l&#39;application.&quot;&quot;&quot;</span>

        <span class="c1"># Vue d&#39;accueil</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">views</span><span class="p">[</span><span class="s1">&#39;welcome&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">WelcomeView</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stacked_widget</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">views</span><span class="p">[</span><span class="s1">&#39;welcome&#39;</span><span class="p">])</span>

        <span class="c1"># Vue d&#39;acquisition</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">views</span><span class="p">[</span><span class="s1">&#39;acquisition&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">AcquisitionView</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stacked_widget</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">views</span><span class="p">[</span><span class="s1">&#39;acquisition&#39;</span><span class="p">])</span>

        <span class="c1"># Vue d&#39;analyse</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">views</span><span class="p">[</span><span class="s1">&#39;analysis&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">AnalysisViewV2</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stacked_widget</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">views</span><span class="p">[</span><span class="s1">&#39;analysis&#39;</span><span class="p">])</span>

        <span class="c1"># Vue d&#39;export</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">views</span><span class="p">[</span><span class="s1">&#39;export&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ExportView</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stacked_widget</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">views</span><span class="p">[</span><span class="s1">&#39;export&#39;</span><span class="p">])</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">change_view</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">view_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Changement de vue.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">view_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">views</span><span class="p">:</span>
            <span class="n">view_widget</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">views</span><span class="p">[</span><span class="n">view_name</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stacked_widget</span><span class="o">.</span><span class="n">setCurrentWidget</span><span class="p">(</span><span class="n">view_widget</span><span class="p">)</span>

            <span class="c1"># Notification à la vue</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">view_widget</span><span class="p">,</span> <span class="s1">&#39;on_view_activated&#39;</span><span class="p">):</span>
                <span class="n">view_widget</span><span class="o">.</span><span class="n">on_view_activated</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">show_main_window</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Affichage de la fenêtre principale.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">change_view</span><span class="p">(</span><span class="s1">&#39;welcome&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="composants-material-design">
<h3>Composants Material Design<a class="headerlink" href="#composants-material-design" title="Lien vers cette rubrique"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">PySide6.QtWidgets</span><span class="w"> </span><span class="kn">import</span> <span class="n">QPushButton</span><span class="p">,</span> <span class="n">QGraphicsDropShadowEffect</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">PySide6.QtCore</span><span class="w"> </span><span class="kn">import</span> <span class="n">QPropertyAnimation</span><span class="p">,</span> <span class="n">QEasingCurve</span><span class="p">,</span> <span class="n">pyqtProperty</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">PySide6.QtGui</span><span class="w"> </span><span class="kn">import</span> <span class="n">QColor</span><span class="p">,</span> <span class="n">QPainter</span><span class="p">,</span> <span class="n">QPainterPath</span>

<span class="k">class</span><span class="w"> </span><span class="nc">MaterialButton</span><span class="p">(</span><span class="n">QPushButton</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Bouton Material Design.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>

        <span class="c1"># Propriétés Material</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_elevation</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ripple_color</span> <span class="o">=</span> <span class="n">QColor</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">80</span><span class="p">)</span>

        <span class="c1"># Animation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_animation</span> <span class="o">=</span> <span class="n">QPropertyAnimation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&quot;elevation&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_animation</span><span class="o">.</span><span class="n">setDuration</span><span class="p">(</span><span class="mi">150</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_animation</span><span class="o">.</span><span class="n">setEasingCurve</span><span class="p">(</span><span class="n">QEasingCurve</span><span class="o">.</span><span class="n">OutCubic</span><span class="p">)</span>

        <span class="c1"># Style de base</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setup_style</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setup_shadow</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_setup_style</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Configuration du style de base.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            MaterialButton {</span>
<span class="s2">                background-color: #2196F3;</span>
<span class="s2">                color: white;</span>
<span class="s2">                border: none;</span>
<span class="s2">                border-radius: 4px;</span>
<span class="s2">                padding: 8px 16px;</span>
<span class="s2">                font-weight: 500;</span>
<span class="s2">                text-transform: uppercase;</span>
<span class="s2">            }</span>
<span class="s2">            MaterialButton:hover {</span>
<span class="s2">                background-color: #1976D2;</span>
<span class="s2">            }</span>
<span class="s2">            MaterialButton:pressed {</span>
<span class="s2">                background-color: #0D47A1;</span>
<span class="s2">            }</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_setup_shadow</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Configuration de l&#39;ombre.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shadow_effect</span> <span class="o">=</span> <span class="n">QGraphicsDropShadowEffect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shadow_effect</span><span class="o">.</span><span class="n">setBlurRadius</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_elevation</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shadow_effect</span><span class="o">.</span><span class="n">setOffset</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_elevation</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shadow_effect</span><span class="o">.</span><span class="n">setColor</span><span class="p">(</span><span class="n">QColor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">60</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setGraphicsEffect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shadow_effect</span><span class="p">)</span>

    <span class="nd">@pyqtProperty</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">elevation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_elevation</span>

    <span class="nd">@elevation</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">elevation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_elevation</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_shadow</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_update_shadow</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Mise à jour de l&#39;ombre selon l&#39;élévation.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shadow_effect</span><span class="o">.</span><span class="n">setBlurRadius</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_elevation</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shadow_effect</span><span class="o">.</span><span class="n">setOffset</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_elevation</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">enterEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Animation d&#39;entrée de souris.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_animation</span><span class="o">.</span><span class="n">setStartValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_elevation</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_animation</span><span class="o">.</span><span class="n">setEndValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_elevation</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_animation</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">enterEvent</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">leaveEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Animation de sortie de souris.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_animation</span><span class="o">.</span><span class="n">setStartValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_elevation</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_animation</span><span class="o">.</span><span class="n">setEndValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_elevation</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_animation</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">leaveEvent</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="gestion-des-themes">
<h3>Gestion des Thèmes<a class="headerlink" href="#gestion-des-themes" title="Lien vers cette rubrique"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>

<span class="k">class</span><span class="w"> </span><span class="nc">ThemeManager</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Gestionnaire de thèmes.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">themes_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;config/themes&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_theme</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">themes</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Chargement des thèmes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_load_themes</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_load_themes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Chargement des thèmes disponibles.&quot;&quot;&quot;</span>

        <span class="c1"># Thème par défaut</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">themes</span><span class="p">[</span><span class="s1">&#39;default&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Défaut&#39;</span><span class="p">,</span>
            <span class="s1">&#39;colors&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;primary&#39;</span><span class="p">:</span> <span class="s1">&#39;#2196F3&#39;</span><span class="p">,</span>
                <span class="s1">&#39;secondary&#39;</span><span class="p">:</span> <span class="s1">&#39;#FFC107&#39;</span><span class="p">,</span>
                <span class="s1">&#39;background&#39;</span><span class="p">:</span> <span class="s1">&#39;#FAFAFA&#39;</span><span class="p">,</span>
                <span class="s1">&#39;surface&#39;</span><span class="p">:</span> <span class="s1">&#39;#FFFFFF&#39;</span><span class="p">,</span>
                <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;#F44336&#39;</span><span class="p">,</span>
                <span class="s1">&#39;text_primary&#39;</span><span class="p">:</span> <span class="s1">&#39;#212121&#39;</span><span class="p">,</span>
                <span class="s1">&#39;text_secondary&#39;</span><span class="p">:</span> <span class="s1">&#39;#757575&#39;</span>
            <span class="p">},</span>
            <span class="s1">&#39;fonts&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;family&#39;</span><span class="p">:</span> <span class="s1">&#39;Segoe UI&#39;</span><span class="p">,</span>
                <span class="s1">&#39;size_small&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
                <span class="s1">&#39;size_normal&#39;</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span>
                <span class="s1">&#39;size_large&#39;</span><span class="p">:</span> <span class="mi">14</span><span class="p">,</span>
                <span class="s1">&#39;size_title&#39;</span><span class="p">:</span> <span class="mi">18</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1"># Thème sombre</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">themes</span><span class="p">[</span><span class="s1">&#39;dark&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Sombre&#39;</span><span class="p">,</span>
            <span class="s1">&#39;colors&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;primary&#39;</span><span class="p">:</span> <span class="s1">&#39;#BB86FC&#39;</span><span class="p">,</span>
                <span class="s1">&#39;secondary&#39;</span><span class="p">:</span> <span class="s1">&#39;#03DAC6&#39;</span><span class="p">,</span>
                <span class="s1">&#39;background&#39;</span><span class="p">:</span> <span class="s1">&#39;#121212&#39;</span><span class="p">,</span>
                <span class="s1">&#39;surface&#39;</span><span class="p">:</span> <span class="s1">&#39;#1E1E1E&#39;</span><span class="p">,</span>
                <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;#CF6679&#39;</span><span class="p">,</span>
                <span class="s1">&#39;text_primary&#39;</span><span class="p">:</span> <span class="s1">&#39;#FFFFFF&#39;</span><span class="p">,</span>
                <span class="s1">&#39;text_secondary&#39;</span><span class="p">:</span> <span class="s1">&#39;#AAAAAA&#39;</span>
            <span class="p">},</span>
            <span class="s1">&#39;fonts&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;family&#39;</span><span class="p">:</span> <span class="s1">&#39;Segoe UI&#39;</span><span class="p">,</span>
                <span class="s1">&#39;size_small&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
                <span class="s1">&#39;size_normal&#39;</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span>
                <span class="s1">&#39;size_large&#39;</span><span class="p">:</span> <span class="mi">14</span><span class="p">,</span>
                <span class="s1">&#39;size_title&#39;</span><span class="p">:</span> <span class="mi">18</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1"># Chargement des thèmes personnalisés</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">themes_dir</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">theme_file</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">themes_dir</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;*.json&#39;</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">theme_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                        <span class="n">theme_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                        <span class="n">theme_name</span> <span class="o">=</span> <span class="n">theme_file</span><span class="o">.</span><span class="n">stem</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">themes</span><span class="p">[</span><span class="n">theme_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">theme_data</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Erreur chargement thème </span><span class="si">{</span><span class="n">theme_file</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">apply_theme</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">theme_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Application d&#39;un thème.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">theme_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">themes</span><span class="p">:</span>
            <span class="n">theme_name</span> <span class="o">=</span> <span class="s1">&#39;default&#39;</span>

        <span class="n">theme</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">themes</span><span class="p">[</span><span class="n">theme_name</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_theme</span> <span class="o">=</span> <span class="n">theme_name</span>

        <span class="c1"># Génération du stylesheet</span>
        <span class="n">stylesheet</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_stylesheet</span><span class="p">(</span><span class="n">theme</span><span class="p">)</span>

        <span class="c1"># Application à l&#39;application</span>
        <span class="n">app</span> <span class="o">=</span> <span class="n">QApplication</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">app</span><span class="p">:</span>
            <span class="n">app</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="n">stylesheet</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_generate_stylesheet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">theme</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Génération du stylesheet à partir du thème.&quot;&quot;&quot;</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="n">theme</span><span class="p">[</span><span class="s1">&#39;colors&#39;</span><span class="p">]</span>
        <span class="n">fonts</span> <span class="o">=</span> <span class="n">theme</span><span class="p">[</span><span class="s1">&#39;fonts&#39;</span><span class="p">]</span>

        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        QMainWindow </span><span class="se">{{</span>
<span class="s2">            background-color: </span><span class="si">{</span><span class="n">colors</span><span class="p">[</span><span class="s1">&#39;background&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">;</span>
<span class="s2">            color: </span><span class="si">{</span><span class="n">colors</span><span class="p">[</span><span class="s1">&#39;text_primary&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">;</span>
<span class="s2">            font-family: </span><span class="si">{</span><span class="n">fonts</span><span class="p">[</span><span class="s1">&#39;family&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">;</span>
<span class="s2">            font-size: </span><span class="si">{</span><span class="n">fonts</span><span class="p">[</span><span class="s1">&#39;size_normal&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">px;</span>
<span class="s2">        </span><span class="se">}}</span>

<span class="s2">        QWidget </span><span class="se">{{</span>
<span class="s2">            background-color: </span><span class="si">{</span><span class="n">colors</span><span class="p">[</span><span class="s1">&#39;background&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">;</span>
<span class="s2">            color: </span><span class="si">{</span><span class="n">colors</span><span class="p">[</span><span class="s1">&#39;text_primary&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">;</span>
<span class="s2">        </span><span class="se">}}</span>

<span class="s2">        QPushButton </span><span class="se">{{</span>
<span class="s2">            background-color: </span><span class="si">{</span><span class="n">colors</span><span class="p">[</span><span class="s1">&#39;primary&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">;</span>
<span class="s2">            color: white;</span>
<span class="s2">            border: none;</span>
<span class="s2">            border-radius: 4px;</span>
<span class="s2">            padding: 8px 16px;</span>
<span class="s2">            font-weight: 500;</span>
<span class="s2">        </span><span class="se">}}</span>

<span class="s2">        QPushButton:hover </span><span class="se">{{</span>
<span class="s2">            background-color: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_darken_color</span><span class="p">(</span><span class="n">colors</span><span class="p">[</span><span class="s1">&#39;primary&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">;</span>
<span class="s2">        </span><span class="se">}}</span>

<span class="s2">        QLineEdit </span><span class="se">{{</span>
<span class="s2">            background-color: </span><span class="si">{</span><span class="n">colors</span><span class="p">[</span><span class="s1">&#39;surface&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">;</span>
<span class="s2">            border: 1px solid </span><span class="si">{</span><span class="n">colors</span><span class="p">[</span><span class="s1">&#39;text_secondary&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">;</span>
<span class="s2">            border-radius: 4px;</span>
<span class="s2">            padding: 8px;</span>
<span class="s2">        </span><span class="se">}}</span>

<span class="s2">        QTextEdit </span><span class="se">{{</span>
<span class="s2">            background-color: </span><span class="si">{</span><span class="n">colors</span><span class="p">[</span><span class="s1">&#39;surface&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">;</span>
<span class="s2">            border: 1px solid </span><span class="si">{</span><span class="n">colors</span><span class="p">[</span><span class="s1">&#39;text_secondary&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">;</span>
<span class="s2">            border-radius: 4px;</span>
<span class="s2">        </span><span class="se">}}</span>

<span class="s2">        QLabel </span><span class="se">{{</span>
<span class="s2">            color: </span><span class="si">{</span><span class="n">colors</span><span class="p">[</span><span class="s1">&#39;text_primary&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">;</span>
<span class="s2">        </span><span class="se">}}</span>

<span class="s2">        QMenuBar </span><span class="se">{{</span>
<span class="s2">            background-color: </span><span class="si">{</span><span class="n">colors</span><span class="p">[</span><span class="s1">&#39;surface&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">;</span>
<span class="s2">            color: </span><span class="si">{</span><span class="n">colors</span><span class="p">[</span><span class="s1">&#39;text_primary&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">;</span>
<span class="s2">        </span><span class="se">}}</span>

<span class="s2">        QMenuBar::item:selected </span><span class="se">{{</span>
<span class="s2">            background-color: </span><span class="si">{</span><span class="n">colors</span><span class="p">[</span><span class="s1">&#39;primary&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">;</span>
<span class="s2">        </span><span class="se">}}</span>

<span class="s2">        QStatusBar </span><span class="se">{{</span>
<span class="s2">            background-color: </span><span class="si">{</span><span class="n">colors</span><span class="p">[</span><span class="s1">&#39;surface&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">;</span>
<span class="s2">            color: </span><span class="si">{</span><span class="n">colors</span><span class="p">[</span><span class="s1">&#39;text_secondary&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">;</span>
<span class="s2">        </span><span class="se">}}</span>
<span class="s2">        &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_darken_color</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">color_hex</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="mf">0.8</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Assombrissement d&#39;une couleur.&quot;&quot;&quot;</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">QColor</span><span class="p">(</span><span class="n">color_hex</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">color</span><span class="o">.</span><span class="n">darker</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="mi">100</span><span class="o">/</span><span class="n">factor</span><span class="p">))</span><span class="o">.</span><span class="n">name</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_available_themes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Liste des thèmes disponibles.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[(</span><span class="n">name</span><span class="p">,</span> <span class="n">theme</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">theme</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">themes</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">save_custom_theme</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">theme_name</span><span class="p">,</span> <span class="n">theme_data</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sauvegarde d&#39;un thème personnalisé.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">themes_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">theme_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">themes_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">theme_name</span><span class="si">}</span><span class="s2">.json&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">theme_file</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">theme_data</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">themes</span><span class="p">[</span><span class="n">theme_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">theme_data</span>
</pre></div>
</div>
</section>
</section>
<section id="performance-et-optimisation">
<h2>Performance et Optimisation<a class="headerlink" href="#performance-et-optimisation" title="Lien vers cette rubrique"></a></h2>
<section id="monitoring-des-performances">
<h3>Monitoring des Performances<a class="headerlink" href="#monitoring-des-performances" title="Lien vers cette rubrique"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">psutil</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">threading</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">deque</span>

<span class="k">class</span><span class="w"> </span><span class="nc">PerformanceMonitor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Moniteur de performance système.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">history_size</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">history_size</span> <span class="o">=</span> <span class="n">history_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metrics_history</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;cpu_percent&#39;</span><span class="p">:</span> <span class="n">deque</span><span class="p">(</span><span class="n">maxlen</span><span class="o">=</span><span class="n">history_size</span><span class="p">),</span>
            <span class="s1">&#39;memory_percent&#39;</span><span class="p">:</span> <span class="n">deque</span><span class="p">(</span><span class="n">maxlen</span><span class="o">=</span><span class="n">history_size</span><span class="p">),</span>
            <span class="s1">&#39;memory_mb&#39;</span><span class="p">:</span> <span class="n">deque</span><span class="p">(</span><span class="n">maxlen</span><span class="o">=</span><span class="n">history_size</span><span class="p">),</span>
            <span class="s1">&#39;disk_io_read&#39;</span><span class="p">:</span> <span class="n">deque</span><span class="p">(</span><span class="n">maxlen</span><span class="o">=</span><span class="n">history_size</span><span class="p">),</span>
            <span class="s1">&#39;disk_io_write&#39;</span><span class="p">:</span> <span class="n">deque</span><span class="p">(</span><span class="n">maxlen</span><span class="o">=</span><span class="n">history_size</span><span class="p">),</span>
            <span class="s1">&#39;timestamps&#39;</span><span class="p">:</span> <span class="n">deque</span><span class="p">(</span><span class="n">maxlen</span><span class="o">=</span><span class="n">history_size</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">monitoring</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">monitor_thread</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_interval</span> <span class="o">=</span> <span class="mf">1.0</span>  <span class="c1"># secondes</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">start_monitoring</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Démarrage du monitoring.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitoring</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">monitoring</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">monitor_thread</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_monitor_loop</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">monitor_thread</span><span class="o">.</span><span class="n">daemon</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">monitor_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">stop_monitoring</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Arrêt du monitoring.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">monitoring</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitor_thread</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">monitor_thread</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_monitor_loop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Boucle de monitoring.&quot;&quot;&quot;</span>
        <span class="n">process</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">Process</span><span class="p">()</span>

        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitoring</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># Métriques CPU</span>
                <span class="n">cpu_percent</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">cpu_percent</span><span class="p">()</span>

                <span class="c1"># Métriques mémoire</span>
                <span class="n">memory_info</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">memory_info</span><span class="p">()</span>
                <span class="n">memory_mb</span> <span class="o">=</span> <span class="n">memory_info</span><span class="o">.</span><span class="n">rss</span> <span class="o">/</span> <span class="mi">1024</span> <span class="o">/</span> <span class="mi">1024</span>
                <span class="n">memory_percent</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">memory_percent</span><span class="p">()</span>

                <span class="c1"># Métriques disque</span>
                <span class="n">io_counters</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">io_counters</span><span class="p">()</span>

                <span class="c1"># Stockage</span>
                <span class="n">timestamp</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">metrics_history</span><span class="p">[</span><span class="s1">&#39;cpu_percent&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cpu_percent</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">metrics_history</span><span class="p">[</span><span class="s1">&#39;memory_percent&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">memory_percent</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">metrics_history</span><span class="p">[</span><span class="s1">&#39;memory_mb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">memory_mb</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">metrics_history</span><span class="p">[</span><span class="s1">&#39;disk_io_read&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">io_counters</span><span class="o">.</span><span class="n">read_bytes</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">metrics_history</span><span class="p">[</span><span class="s1">&#39;disk_io_write&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">io_counters</span><span class="o">.</span><span class="n">write_bytes</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">metrics_history</span><span class="p">[</span><span class="s1">&#39;timestamps&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">timestamp</span><span class="p">)</span>

            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Erreur monitoring: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_interval</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_current_metrics</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Métriques actuelles.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">metrics_history</span><span class="p">[</span><span class="s1">&#39;timestamps&#39;</span><span class="p">]:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;cpu_percent&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">metrics_history</span><span class="p">[</span><span class="s1">&#39;cpu_percent&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
            <span class="s1">&#39;memory_percent&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">metrics_history</span><span class="p">[</span><span class="s1">&#39;memory_percent&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
            <span class="s1">&#39;memory_mb&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">metrics_history</span><span class="p">[</span><span class="s1">&#39;memory_mb&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
            <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">metrics_history</span><span class="p">[</span><span class="s1">&#39;timestamps&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_performance_report</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Rapport de performance.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">metrics_history</span><span class="p">[</span><span class="s1">&#39;timestamps&#39;</span><span class="p">]:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">cpu_data</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metrics_history</span><span class="p">[</span><span class="s1">&#39;cpu_percent&#39;</span><span class="p">])</span>
        <span class="n">memory_data</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metrics_history</span><span class="p">[</span><span class="s1">&#39;memory_mb&#39;</span><span class="p">])</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;monitoring_duration&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metrics_history</span><span class="p">[</span><span class="s1">&#39;timestamps&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_interval</span><span class="p">,</span>
            <span class="s1">&#39;cpu_stats&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;mean&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cpu_data</span><span class="p">),</span>
                <span class="s1">&#39;max&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">cpu_data</span><span class="p">),</span>
                <span class="s1">&#39;min&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">cpu_data</span><span class="p">),</span>
                <span class="s1">&#39;std&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">cpu_data</span><span class="p">)</span>
            <span class="p">},</span>
            <span class="s1">&#39;memory_stats&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;mean_mb&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">memory_data</span><span class="p">),</span>
                <span class="s1">&#39;max_mb&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">memory_data</span><span class="p">),</span>
                <span class="s1">&#39;min_mb&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">memory_data</span><span class="p">),</span>
                <span class="s1">&#39;current_mb&#39;</span><span class="p">:</span> <span class="n">memory_data</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">memory_data</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="p">},</span>
            <span class="s1">&#39;recommendations&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_recommendations</span><span class="p">(</span><span class="n">cpu_data</span><span class="p">,</span> <span class="n">memory_data</span><span class="p">)</span>
        <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_generate_recommendations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cpu_data</span><span class="p">,</span> <span class="n">memory_data</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Génération de recommandations d&#39;optimisation.&quot;&quot;&quot;</span>
        <span class="n">recommendations</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Analyse CPU</span>
        <span class="n">avg_cpu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cpu_data</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">avg_cpu</span> <span class="o">&gt;</span> <span class="mi">80</span><span class="p">:</span>
            <span class="n">recommendations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;CPU élevé: Réduire la fréquence d&#39;acquisition ou optimiser les calculs&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">avg_cpu</span> <span class="o">&gt;</span> <span class="mi">60</span><span class="p">:</span>
            <span class="n">recommendations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;CPU modéré: Surveiller les pics d&#39;utilisation&quot;</span><span class="p">)</span>

        <span class="c1"># Analyse mémoire</span>
        <span class="n">max_memory</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">memory_data</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">max_memory</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">:</span>  <span class="c1"># &gt; 1GB</span>
            <span class="n">recommendations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Mémoire élevée: Optimiser les buffers ou réduire la taille des données&quot;</span><span class="p">)</span>

        <span class="c1"># Tendances</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">memory_data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
            <span class="n">recent_trend</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">memory_data</span><span class="p">[</span><span class="o">-</span><span class="mi">10</span><span class="p">:])),</span> <span class="n">memory_data</span><span class="p">[</span><span class="o">-</span><span class="mi">10</span><span class="p">:],</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">recent_trend</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># Augmentation &gt; 1MB par mesure</span>
                <span class="n">recommendations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Fuite mémoire potentielle détectée&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">recommendations</span>
</pre></div>
</div>
</section>
<section id="optimisation-des-calculs">
<h3>Optimisation des Calculs<a class="headerlink" href="#optimisation-des-calculs" title="Lien vers cette rubrique"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">numba</span><span class="w"> </span><span class="kn">import</span> <span class="n">jit</span><span class="p">,</span> <span class="n">prange</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">concurrent.futures</span><span class="w"> </span><span class="kn">import</span> <span class="n">ThreadPoolExecutor</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">multiprocessing</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">mp</span>

<span class="k">class</span><span class="w"> </span><span class="nc">OptimizedProcessor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Processeur optimisé pour les calculs intensifs.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">use_numba</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">n_workers</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">use_numba</span> <span class="o">=</span> <span class="n">use_numba</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_workers</span> <span class="o">=</span> <span class="n">n_workers</span> <span class="ow">or</span> <span class="n">mp</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">executor</span> <span class="o">=</span> <span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n_workers</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="nd">@jit</span><span class="p">(</span><span class="n">nopython</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">parallel</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_fast_fft_magnitude</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calcul rapide de magnitude FFT avec Numba.&quot;&quot;&quot;</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="o">//</span><span class="mi">2</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">prange</span><span class="p">(</span><span class="n">n</span><span class="o">//</span><span class="mi">2</span><span class="p">):</span>
            <span class="n">real_sum</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">imag_sum</span> <span class="o">=</span> <span class="mf">0.0</span>

            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
                <span class="n">angle</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">i</span> <span class="o">*</span> <span class="n">j</span> <span class="o">/</span> <span class="n">n</span>
                <span class="n">cos_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
                <span class="n">sin_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>

                <span class="n">real_sum</span> <span class="o">+=</span> <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">cos_val</span>
                <span class="n">imag_sum</span> <span class="o">+=</span> <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">sin_val</span>

            <span class="n">result</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">real_sum</span><span class="o">*</span><span class="n">real_sum</span> <span class="o">+</span> <span class="n">imag_sum</span><span class="o">*</span><span class="n">imag_sum</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">compute_spectrum_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_batch</span><span class="p">,</span> <span class="n">window_size</span><span class="o">=</span><span class="mi">1024</span><span class="p">,</span> <span class="n">overlap</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calcul de spectres par batch.&quot;&quot;&quot;</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">process_single_spectrum</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_numba</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fast_fft_magnitude</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="n">data</span><span class="p">)[:</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">])</span>

        <span class="c1"># Division en chunks</span>
        <span class="n">step</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">window_size</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">overlap</span><span class="p">))</span>
        <span class="n">chunks</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">data_batch</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">-</span> <span class="n">window_size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">step</span><span class="p">):</span>
                <span class="n">chunk</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="n">window_size</span><span class="p">]</span>
                <span class="n">chunks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>

        <span class="c1"># Traitement parallèle</span>
        <span class="n">futures</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">chunks</span><span class="p">:</span>
            <span class="n">future</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">process_single_spectrum</span><span class="p">,</span> <span class="n">chunk</span><span class="p">)</span>
            <span class="n">futures</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">future</span><span class="p">)</span>

        <span class="c1"># Collecte des résultats</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">future</span> <span class="ow">in</span> <span class="n">futures</span><span class="p">:</span>
            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">future</span><span class="o">.</span><span class="n">result</span><span class="p">())</span>

        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="nd">@jit</span><span class="p">(</span><span class="n">nopython</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_fast_statistics</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calcul rapide de statistiques avec Numba.&quot;&quot;&quot;</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="c1"># Moyenne</span>
        <span class="n">mean_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">/</span> <span class="n">n</span>

        <span class="c1"># Variance</span>
        <span class="n">var_sum</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="n">diff</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">mean_val</span>
            <span class="n">var_sum</span> <span class="o">+=</span> <span class="n">diff</span> <span class="o">*</span> <span class="n">diff</span>
        <span class="n">variance</span> <span class="o">=</span> <span class="n">var_sum</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Min/Max</span>
        <span class="n">min_val</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">max_val</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">min_val</span><span class="p">:</span>
                <span class="n">min_val</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">max_val</span><span class="p">:</span>
                <span class="n">max_val</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">mean_val</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">variance</span><span class="p">),</span> <span class="n">min_val</span><span class="p">,</span> <span class="n">max_val</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">compute_statistics_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_batch</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calcul de statistiques par batch.&quot;&quot;&quot;</span>

        <span class="n">futures</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">data_batch</span><span class="p">:</span>
            <span class="n">future</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fast_statistics</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
            <span class="n">futures</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">future</span><span class="p">)</span>

        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">future</span> <span class="ow">in</span> <span class="n">futures</span><span class="p">:</span>
            <span class="n">mean</span><span class="p">,</span> <span class="n">std</span><span class="p">,</span> <span class="n">min_val</span><span class="p">,</span> <span class="n">max_val</span> <span class="o">=</span> <span class="n">future</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s1">&#39;mean&#39;</span><span class="p">:</span> <span class="n">mean</span><span class="p">,</span>
                <span class="s1">&#39;std&#39;</span><span class="p">:</span> <span class="n">std</span><span class="p">,</span>
                <span class="s1">&#39;min&#39;</span><span class="p">:</span> <span class="n">min_val</span><span class="p">,</span>
                <span class="s1">&#39;max&#39;</span><span class="p">:</span> <span class="n">max_val</span>
            <span class="p">})</span>

        <span class="k">return</span> <span class="n">results</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">cleanup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Nettoyage des ressources.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">executor</span><span class="o">.</span><span class="n">shutdown</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="gestion-memoire">
<h3>Gestion Mémoire<a class="headerlink" href="#gestion-memoire" title="Lien vers cette rubrique"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">gc</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">weakref</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">contextlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">contextmanager</span>

<span class="k">class</span><span class="w"> </span><span class="nc">MemoryManager</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Gestionnaire de mémoire optimisé.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tracked_objects</span> <span class="o">=</span> <span class="n">weakref</span><span class="o">.</span><span class="n">WeakSet</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">memory_pools</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="nd">@contextmanager</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">memory_context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_memory_mb</span><span class="o">=</span><span class="mi">500</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Contexte de gestion mémoire.&quot;&quot;&quot;</span>
        <span class="n">initial_memory</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_memory_usage</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">yield</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">current_memory</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_memory_usage</span><span class="p">()</span>
            <span class="n">memory_used</span> <span class="o">=</span> <span class="n">current_memory</span> <span class="o">-</span> <span class="n">initial_memory</span>

            <span class="k">if</span> <span class="n">memory_used</span> <span class="o">&gt;</span> <span class="n">max_memory_mb</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_force_cleanup</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_memory_usage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Utilisation mémoire actuelle en MB.&quot;&quot;&quot;</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">psutil</span>
        <span class="n">process</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">Process</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">process</span><span class="o">.</span><span class="n">memory_info</span><span class="p">()</span><span class="o">.</span><span class="n">rss</span> <span class="o">/</span> <span class="mi">1024</span> <span class="o">/</span> <span class="mi">1024</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_force_cleanup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Nettoyage forcé de la mémoire.&quot;&quot;&quot;</span>
        <span class="c1"># Nettoyage des objets trackés</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tracked_objects</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s1">&#39;cleanup&#39;</span><span class="p">):</span>
                <span class="n">obj</span><span class="o">.</span><span class="n">cleanup</span><span class="p">()</span>

        <span class="c1"># Garbage collection agressif</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">track_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Ajout d&#39;un objet au tracking.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tracked_objects</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">create_array_pool</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pool_name</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">pool_size</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Création d&#39;un pool de tableaux réutilisables.&quot;&quot;&quot;</span>
        <span class="n">pool</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">pool_size</span><span class="p">):</span>
            <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
            <span class="n">pool</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">memory_pools</span><span class="p">[</span><span class="n">pool_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;pool&#39;</span><span class="p">:</span> <span class="n">pool</span><span class="p">,</span>
            <span class="s1">&#39;available&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">pool_size</span><span class="p">)),</span>
            <span class="s1">&#39;in_use&#39;</span><span class="p">:</span> <span class="nb">set</span><span class="p">()</span>
        <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_array_from_pool</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pool_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Récupération d&#39;un tableau du pool.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">pool_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">memory_pools</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">pool_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">memory_pools</span><span class="p">[</span><span class="n">pool_name</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">pool_info</span><span class="p">[</span><span class="s1">&#39;available&#39;</span><span class="p">]:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">pool_info</span><span class="p">[</span><span class="s1">&#39;available&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="n">pool_info</span><span class="p">[</span><span class="s1">&#39;in_use&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">pool_info</span><span class="p">[</span><span class="s1">&#39;pool&#39;</span><span class="p">][</span><span class="n">index</span><span class="p">]</span>

        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">return_array_to_pool</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pool_name</span><span class="p">,</span> <span class="n">array</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retour d&#39;un tableau au pool.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">pool_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">memory_pools</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">pool_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">memory_pools</span><span class="p">[</span><span class="n">pool_name</span><span class="p">]</span>

        <span class="c1"># Recherche de l&#39;index du tableau</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">pool_array</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pool_info</span><span class="p">[</span><span class="s1">&#39;pool&#39;</span><span class="p">]):</span>
            <span class="k">if</span> <span class="n">pool_array</span> <span class="ow">is</span> <span class="n">array</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">pool_info</span><span class="p">[</span><span class="s1">&#39;in_use&#39;</span><span class="p">]:</span>
                    <span class="n">pool_info</span><span class="p">[</span><span class="s1">&#39;in_use&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                    <span class="n">pool_info</span><span class="p">[</span><span class="s1">&#39;available&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                    <span class="c1"># Remise à zéro du tableau</span>
                    <span class="n">array</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="k">break</span>
</pre></div>
</div>
</section>
</section>
<section id="tests-et-validation">
<h2>Tests et Validation<a class="headerlink" href="#tests-et-validation" title="Lien vers cette rubrique"></a></h2>
<section id="architecture-de-tests">
<h3>Architecture de Tests<a class="headerlink" href="#architecture-de-tests" title="Lien vers cette rubrique"></a></h3>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>tests/
├── unit/               # Tests unitaires
│   ├── test_core/
│   ├── test_data/
│   ├── test_analysis/
│   └── test_gui/
├── integration/        # Tests d&#39;intégration
│   ├── test_workflows/
│   └── test_end_to_end/
├── performance/        # Tests de performance
│   ├── test_benchmarks/
│   └── test_memory/
├── fixtures/           # Données de test
│   ├── sample_data/
│   └── mock_configs/
└── conftest.py         # Configuration pytest
</pre></div>
</div>
</section>
<section id="tests-unitaires">
<h3>Tests Unitaires<a class="headerlink" href="#tests-unitaires" title="Lien vers cette rubrique"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">unittest.mock</span><span class="w"> </span><span class="kn">import</span> <span class="n">Mock</span><span class="p">,</span> <span class="n">patch</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hrneowave.analysis.spectral</span><span class="w"> </span><span class="kn">import</span> <span class="n">SpectralAnalyzer</span>

<span class="k">class</span><span class="w"> </span><span class="nc">TestSpectralAnalyzer</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Tests pour l&#39;analyseur spectral.&quot;&quot;&quot;</span>

    <span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">analyzer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Fixture analyseur spectral.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">SpectralAnalyzer</span><span class="p">()</span>

    <span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">sample_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Fixture données d&#39;exemple.&quot;&quot;&quot;</span>
        <span class="c1"># Signal sinusoïdal + bruit</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
        <span class="n">signal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">signal</span><span class="p">,</span>
            <span class="s1">&#39;sampling_rate&#39;</span><span class="p">:</span> <span class="mf">100.0</span><span class="p">,</span>
            <span class="s1">&#39;timestamps&#39;</span><span class="p">:</span> <span class="n">t</span>
        <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_fft_computation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">analyzer</span><span class="p">,</span> <span class="n">sample_data</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test calcul FFT.&quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">analyzer</span><span class="o">.</span><span class="n">compute_fft</span><span class="p">(</span>
            <span class="n">sample_data</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">],</span>
            <span class="n">sampling_rate</span><span class="o">=</span><span class="n">sample_data</span><span class="p">[</span><span class="s1">&#39;sampling_rate&#39;</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="c1"># Vérifications</span>
        <span class="k">assert</span> <span class="s1">&#39;frequencies&#39;</span> <span class="ow">in</span> <span class="n">result</span>
        <span class="k">assert</span> <span class="s1">&#39;magnitude&#39;</span> <span class="ow">in</span> <span class="n">result</span>
        <span class="k">assert</span> <span class="s1">&#39;phase&#39;</span> <span class="ow">in</span> <span class="n">result</span>

        <span class="c1"># Taille correcte</span>
        <span class="n">expected_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sample_data</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">])</span> <span class="o">//</span> <span class="mi">2</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;frequencies&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="n">expected_size</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;magnitude&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="n">expected_size</span>

        <span class="c1"># Pic à 5 Hz</span>
        <span class="n">peak_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;magnitude&#39;</span><span class="p">])</span>
        <span class="n">peak_freq</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;frequencies&#39;</span><span class="p">][</span><span class="n">peak_idx</span><span class="p">]</span>
        <span class="k">assert</span> <span class="nb">abs</span><span class="p">(</span><span class="n">peak_freq</span> <span class="o">-</span> <span class="mf">5.0</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.5</span>  <span class="c1"># Tolérance</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_psd_computation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">analyzer</span><span class="p">,</span> <span class="n">sample_data</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test calcul PSD.&quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">analyzer</span><span class="o">.</span><span class="n">compute_psd</span><span class="p">(</span>
            <span class="n">sample_data</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">],</span>
            <span class="n">sampling_rate</span><span class="o">=</span><span class="n">sample_data</span><span class="p">[</span><span class="s1">&#39;sampling_rate&#39;</span><span class="p">],</span>
            <span class="n">window_size</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span>
            <span class="n">overlap</span><span class="o">=</span><span class="mf">0.5</span>
        <span class="p">)</span>

        <span class="k">assert</span> <span class="s1">&#39;frequencies&#39;</span> <span class="ow">in</span> <span class="n">result</span>
        <span class="k">assert</span> <span class="s1">&#39;psd&#39;</span> <span class="ow">in</span> <span class="n">result</span>
        <span class="k">assert</span> <span class="s1">&#39;confidence_interval&#39;</span> <span class="ow">in</span> <span class="n">result</span>

        <span class="c1"># Valeurs positives</span>
        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;psd&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_spectrogram_computation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">analyzer</span><span class="p">,</span> <span class="n">sample_data</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test calcul spectrogramme.&quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">analyzer</span><span class="o">.</span><span class="n">compute_spectrogram</span><span class="p">(</span>
            <span class="n">sample_data</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">],</span>
            <span class="n">sampling_rate</span><span class="o">=</span><span class="n">sample_data</span><span class="p">[</span><span class="s1">&#39;sampling_rate&#39;</span><span class="p">],</span>
            <span class="n">window_size</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span>
            <span class="n">overlap</span><span class="o">=</span><span class="mf">0.75</span>
        <span class="p">)</span>

        <span class="k">assert</span> <span class="s1">&#39;time&#39;</span> <span class="ow">in</span> <span class="n">result</span>
        <span class="k">assert</span> <span class="s1">&#39;frequencies&#39;</span> <span class="ow">in</span> <span class="n">result</span>
        <span class="k">assert</span> <span class="s1">&#39;spectrogram&#39;</span> <span class="ow">in</span> <span class="n">result</span>

        <span class="c1"># Dimensions cohérentes</span>
        <span class="n">n_time</span><span class="p">,</span> <span class="n">n_freq</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;spectrogram&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="n">n_time</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;frequencies&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="n">n_freq</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_invalid_input_handling</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">analyzer</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test gestion des entrées invalides.&quot;&quot;&quot;</span>

        <span class="c1"># Données vides</span>
        <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
            <span class="n">analyzer</span><span class="o">.</span><span class="n">compute_fft</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]),</span> <span class="n">sampling_rate</span><span class="o">=</span><span class="mf">100.0</span><span class="p">)</span>

        <span class="c1"># Fréquence d&#39;échantillonnage invalide</span>
        <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
            <span class="n">analyzer</span><span class="o">.</span><span class="n">compute_fft</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span> <span class="n">sampling_rate</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Type de données invalide</span>
        <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">):</span>
            <span class="n">analyzer</span><span class="o">.</span><span class="n">compute_fft</span><span class="p">(</span><span class="s2">&quot;invalid_data&quot;</span><span class="p">,</span> <span class="n">sampling_rate</span><span class="o">=</span><span class="mf">100.0</span><span class="p">)</span>

    <span class="nd">@patch</span><span class="p">(</span><span class="s1">&#39;hrneowave.analysis.spectral.np.fft.fft&#39;</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_fft_error_handling</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mock_fft</span><span class="p">,</span> <span class="n">analyzer</span><span class="p">,</span> <span class="n">sample_data</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test gestion d&#39;erreurs FFT.&quot;&quot;&quot;</span>

        <span class="c1"># Simulation d&#39;erreur FFT</span>
        <span class="n">mock_fft</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;FFT failed&quot;</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">):</span>
            <span class="n">analyzer</span><span class="o">.</span><span class="n">compute_fft</span><span class="p">(</span>
                <span class="n">sample_data</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">],</span>
                <span class="n">sampling_rate</span><span class="o">=</span><span class="n">sample_data</span><span class="p">[</span><span class="s1">&#39;sampling_rate&#39;</span><span class="p">]</span>
            <span class="p">)</span>
</pre></div>
</div>
</section>
<section id="tests-d-integration">
<h3>Tests d’Intégration<a class="headerlink" href="#tests-d-integration" title="Lien vers cette rubrique"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">tempfile</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">shutil</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hrneowave.workflows.acquisition_workflow</span><span class="w"> </span><span class="kn">import</span> <span class="n">AcquisitionWorkflow</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hrneowave.data.acquisition</span><span class="w"> </span><span class="kn">import</span> <span class="n">MockAcquisitionDevice</span>

<span class="k">class</span><span class="w"> </span><span class="nc">TestAcquisitionWorkflow</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Tests d&#39;intégration pour le workflow d&#39;acquisition.&quot;&quot;&quot;</span>

    <span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">temp_project_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Répertoire de projet temporaire.&quot;&quot;&quot;</span>
        <span class="n">temp_dir</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkdtemp</span><span class="p">()</span>
        <span class="k">yield</span> <span class="n">Path</span><span class="p">(</span><span class="n">temp_dir</span><span class="p">)</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">temp_dir</span><span class="p">)</span>

    <span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">mock_device</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dispositif d&#39;acquisition simulé.&quot;&quot;&quot;</span>
        <span class="n">device</span> <span class="o">=</span> <span class="n">MockAcquisitionDevice</span><span class="p">()</span>
        <span class="n">device</span><span class="o">.</span><span class="n">configure</span><span class="p">({</span>
            <span class="s1">&#39;sampling_rate&#39;</span><span class="p">:</span> <span class="mf">1000.0</span><span class="p">,</span>
            <span class="s1">&#39;channels&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;channel_1&#39;</span><span class="p">],</span>
            <span class="s1">&#39;noise_level&#39;</span><span class="p">:</span> <span class="mf">0.1</span>
        <span class="p">})</span>
        <span class="k">return</span> <span class="n">device</span>

    <span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">workflow_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">temp_project_dir</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Configuration du workflow.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;project_dir&#39;</span><span class="p">:</span> <span class="n">temp_project_dir</span><span class="p">,</span>
            <span class="s1">&#39;acquisition&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;duration&#39;</span><span class="p">:</span> <span class="mf">5.0</span><span class="p">,</span>  <span class="c1"># 5 secondes</span>
                <span class="s1">&#39;sampling_rate&#39;</span><span class="p">:</span> <span class="mf">1000.0</span><span class="p">,</span>
                <span class="s1">&#39;buffer_size&#39;</span><span class="p">:</span> <span class="mi">1024</span>
            <span class="p">},</span>
            <span class="s1">&#39;processing&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;enable_filtering&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                <span class="s1">&#39;lowpass_cutoff&#39;</span><span class="p">:</span> <span class="mf">100.0</span>
            <span class="p">},</span>
            <span class="s1">&#39;storage&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;format&#39;</span><span class="p">:</span> <span class="s1">&#39;hdf5&#39;</span><span class="p">,</span>
                <span class="s1">&#39;compression&#39;</span><span class="p">:</span> <span class="kc">True</span>
            <span class="p">}</span>
        <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_complete_acquisition_workflow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mock_device</span><span class="p">,</span> <span class="n">workflow_config</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test workflow complet d&#39;acquisition.&quot;&quot;&quot;</span>

        <span class="n">workflow</span> <span class="o">=</span> <span class="n">AcquisitionWorkflow</span><span class="p">(</span><span class="n">workflow_config</span><span class="p">)</span>
        <span class="n">workflow</span><span class="o">.</span><span class="n">set_acquisition_device</span><span class="p">(</span><span class="n">mock_device</span><span class="p">)</span>

        <span class="c1"># Démarrage du workflow</span>
        <span class="n">workflow</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

        <span class="c1"># Attente de la fin</span>
        <span class="n">workflow</span><span class="o">.</span><span class="n">wait_for_completion</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mf">10.0</span><span class="p">)</span>

        <span class="c1"># Vérifications</span>
        <span class="k">assert</span> <span class="n">workflow</span><span class="o">.</span><span class="n">is_completed</span><span class="p">()</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="n">workflow</span><span class="o">.</span><span class="n">has_errors</span><span class="p">()</span>

        <span class="c1"># Vérification des fichiers générés</span>
        <span class="n">project_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">workflow_config</span><span class="p">[</span><span class="s1">&#39;project_dir&#39;</span><span class="p">])</span>
        <span class="n">data_files</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">project_dir</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;data/raw/*.h5&#39;</span><span class="p">))</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_files</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>

        <span class="c1"># Vérification du contenu</span>
        <span class="n">data_file</span> <span class="o">=</span> <span class="n">data_files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">data_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">assert</span> <span class="s1">&#39;raw_data&#39;</span> <span class="ow">in</span> <span class="n">f</span>
            <span class="k">assert</span> <span class="s1">&#39;metadata&#39;</span> <span class="ow">in</span> <span class="n">f</span>

            <span class="c1"># Données cohérentes</span>
            <span class="n">channel_data</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;raw_data/channel_1&#39;</span><span class="p">][:]</span>
            <span class="n">expected_samples</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">workflow_config</span><span class="p">[</span><span class="s1">&#39;acquisition&#39;</span><span class="p">][</span><span class="s1">&#39;duration&#39;</span><span class="p">]</span> <span class="o">*</span>
                                <span class="n">workflow_config</span><span class="p">[</span><span class="s1">&#39;acquisition&#39;</span><span class="p">][</span><span class="s1">&#39;sampling_rate&#39;</span><span class="p">])</span>

            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">channel_data</span><span class="p">)</span> <span class="o">==</span> <span class="n">expected_samples</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_workflow_error_recovery</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mock_device</span><span class="p">,</span> <span class="n">workflow_config</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test récupération d&#39;erreurs.&quot;&quot;&quot;</span>

        <span class="c1"># Configuration d&#39;erreur sur le device</span>
        <span class="n">mock_device</span><span class="o">.</span><span class="n">set_error_mode</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">error_after</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>

        <span class="n">workflow</span> <span class="o">=</span> <span class="n">AcquisitionWorkflow</span><span class="p">(</span><span class="n">workflow_config</span><span class="p">)</span>
        <span class="n">workflow</span><span class="o">.</span><span class="n">set_acquisition_device</span><span class="p">(</span><span class="n">mock_device</span><span class="p">)</span>

        <span class="c1"># Démarrage avec erreur attendue</span>
        <span class="n">workflow</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="n">workflow</span><span class="o">.</span><span class="n">wait_for_completion</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mf">10.0</span><span class="p">)</span>

        <span class="c1"># Vérifications</span>
        <span class="k">assert</span> <span class="n">workflow</span><span class="o">.</span><span class="n">has_errors</span><span class="p">()</span>

        <span class="c1"># Vérification que les données partielles sont sauvées</span>
        <span class="n">project_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">workflow_config</span><span class="p">[</span><span class="s1">&#39;project_dir&#39;</span><span class="p">])</span>
        <span class="n">data_files</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">project_dir</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;data/raw/*.h5&#39;</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">data_files</span><span class="p">:</span>  <span class="c1"># Des données partielles peuvent être sauvées</span>
            <span class="n">data_file</span> <span class="o">=</span> <span class="n">data_files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">data_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">channel_data</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;raw_data/channel_1&#39;</span><span class="p">][:]</span>
                <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">channel_data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
</pre></div>
</div>
</section>
<section id="tests-de-performance">
<h3>Tests de Performance<a class="headerlink" href="#tests-de-performance" title="Lien vers cette rubrique"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">memory_profiler</span><span class="w"> </span><span class="kn">import</span> <span class="n">profile</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hrneowave.analysis.spectral</span><span class="w"> </span><span class="kn">import</span> <span class="n">SpectralAnalyzer</span>

<span class="k">class</span><span class="w"> </span><span class="nc">TestPerformance</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Tests de performance.&quot;&quot;&quot;</span>

    <span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">large_dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Jeu de données volumineux.&quot;&quot;&quot;</span>
        <span class="c1"># 1 million de points</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1000000</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_fft_performance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">large_dataset</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test performance FFT.&quot;&quot;&quot;</span>
        <span class="n">analyzer</span> <span class="o">=</span> <span class="n">SpectralAnalyzer</span><span class="p">()</span>

        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">analyzer</span><span class="o">.</span><span class="n">compute_fft</span><span class="p">(</span><span class="n">large_dataset</span><span class="p">,</span> <span class="n">sampling_rate</span><span class="o">=</span><span class="mf">1000.0</span><span class="p">)</span>
        <span class="n">end_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="n">execution_time</span> <span class="o">=</span> <span class="n">end_time</span> <span class="o">-</span> <span class="n">start_time</span>

        <span class="c1"># Assertion sur le temps d&#39;exécution (&lt; 5 secondes)</span>
        <span class="k">assert</span> <span class="n">execution_time</span> <span class="o">&lt;</span> <span class="mf">5.0</span>

        <span class="c1"># Vérification du résultat</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;magnitude&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">large_dataset</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>

    <span class="nd">@profile</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_memory_usage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">large_dataset</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test utilisation mémoire.&quot;&quot;&quot;</span>
        <span class="n">analyzer</span> <span class="o">=</span> <span class="n">SpectralAnalyzer</span><span class="p">()</span>

        <span class="c1"># Traitement par chunks pour économiser la mémoire</span>
        <span class="n">chunk_size</span> <span class="o">=</span> <span class="mi">10000</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">large_dataset</span><span class="p">),</span> <span class="n">chunk_size</span><span class="p">):</span>
            <span class="n">chunk</span> <span class="o">=</span> <span class="n">large_dataset</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="n">chunk_size</span><span class="p">]</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">analyzer</span><span class="o">.</span><span class="n">compute_fft</span><span class="p">(</span><span class="n">chunk</span><span class="p">,</span> <span class="n">sampling_rate</span><span class="o">=</span><span class="mf">1000.0</span><span class="p">)</span>
            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;magnitude&#39;</span><span class="p">])</span>

        <span class="c1"># Vérification que tous les chunks ont été traités</span>
        <span class="n">expected_chunks</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">large_dataset</span><span class="p">)</span> <span class="o">//</span> <span class="n">chunk_size</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span> <span class="o">==</span> <span class="n">expected_chunks</span>
</pre></div>
</div>
</section>
</section>
<section id="configuration-et-deploiement">
<h2>Configuration et Déploiement<a class="headerlink" href="#configuration-et-deploiement" title="Lien vers cette rubrique"></a></h2>
<section id="configuration-systeme">
<h3>Configuration Système<a class="headerlink" href="#configuration-systeme" title="Lien vers cette rubrique"></a></h3>
<p><strong>Fichier de configuration principal (config/app_config.yaml) :</strong></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># Configuration CHNeoWave</span>
<span class="nt">application</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;CHNeoWave&quot;</span>
<span class="w">  </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1.0.0&quot;</span>
<span class="w">  </span><span class="nt">debug</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">  </span><span class="nt">log_level</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;INFO&quot;</span>

<span class="c1"># Interface utilisateur</span>
<span class="nt">gui</span><span class="p">:</span>
<span class="w">  </span><span class="nt">theme</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;default&quot;</span>
<span class="w">  </span><span class="nt">language</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;fr&quot;</span>
<span class="w">  </span><span class="nt">window</span><span class="p">:</span>
<span class="w">    </span><span class="nt">width</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1200</span>
<span class="w">    </span><span class="nt">height</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">800</span>
<span class="w">    </span><span class="nt">maximized</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>

<span class="w">  </span><span class="c1"># Mise à jour de l&#39;interface</span>
<span class="w">  </span><span class="nt">update_rates</span><span class="p">:</span>
<span class="w">    </span><span class="nt">real_time_display</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30</span><span class="w">  </span><span class="c1"># Hz</span>
<span class="w">    </span><span class="nt">status_bar</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span><span class="w">          </span><span class="c1"># Hz</span>
<span class="w">    </span><span class="nt">progress_bar</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span><span class="w">       </span><span class="c1"># Hz</span>

<span class="c1"># Acquisition de données</span>
<span class="nt">acquisition</span><span class="p">:</span>
<span class="w">  </span><span class="nt">default_sampling_rate</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1000.0</span><span class="w">  </span><span class="c1"># Hz</span>
<span class="w">  </span><span class="nt">buffer_size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8192</span>
<span class="w">  </span><span class="nt">max_channels</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8</span>

<span class="w">  </span><span class="c1"># Communication série</span>
<span class="w">  </span><span class="nt">serial</span><span class="p">:</span>
<span class="w">    </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.0</span>
<span class="w">    </span><span class="nt">baudrate</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">115200</span>
<span class="w">    </span><span class="nt">bytesize</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8</span>
<span class="w">    </span><span class="nt">parity</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;N&quot;</span>
<span class="w">    </span><span class="nt">stopbits</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>

<span class="w">  </span><span class="c1"># Validation des données</span>
<span class="w">  </span><span class="nt">validation</span><span class="p">:</span>
<span class="w">    </span><span class="nt">enable_range_check</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">min_value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">-1000.0</span>
<span class="w">    </span><span class="nt">max_value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1000.0</span>
<span class="w">    </span><span class="nt">enable_spike_detection</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">spike_threshold</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3.0</span>

<span class="c1"># Traitement des données</span>
<span class="nt">processing</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># Filtrage</span>
<span class="w">  </span><span class="nt">filtering</span><span class="p">:</span>
<span class="w">    </span><span class="nt">enable_lowpass</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">lowpass_cutoff</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">100.0</span>
<span class="w">    </span><span class="nt">enable_highpass</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">    </span><span class="nt">highpass_cutoff</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.1</span>
<span class="w">    </span><span class="nt">filter_order</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4</span>

<span class="w">  </span><span class="c1"># Fenêtrage</span>
<span class="w">  </span><span class="nt">windowing</span><span class="p">:</span>
<span class="w">    </span><span class="nt">default_window</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;hann&quot;</span>
<span class="w">    </span><span class="nt">window_size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1024</span>
<span class="w">    </span><span class="nt">overlap</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.5</span>

<span class="c1"># Analyse</span>
<span class="nt">analysis</span><span class="p">:</span>
<span class="w">  </span><span class="nt">spectral</span><span class="p">:</span>
<span class="w">    </span><span class="nt">fft_size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1024</span>
<span class="w">    </span><span class="nt">zero_padding</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">detrend</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;linear&quot;</span>

<span class="w">  </span><span class="nt">wave</span><span class="p">:</span>
<span class="w">    </span><span class="nt">enable_goda_analysis</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">enable_directional_analysis</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">    </span><span class="nt">significant_wave_height_method</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;zero_crossing&quot;</span>

<span class="w">  </span><span class="nt">statistics</span><span class="p">:</span>
<span class="w">    </span><span class="nt">confidence_level</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.95</span>
<span class="w">    </span><span class="nt">enable_outlier_detection</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>

<span class="c1"># Stockage</span>
<span class="nt">storage</span><span class="p">:</span>
<span class="w">  </span><span class="nt">format</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;hdf5&quot;</span>
<span class="w">  </span><span class="nt">compression</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">compression_level</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6</span>

<span class="w">  </span><span class="c1"># Répertoires</span>
<span class="w">  </span><span class="nt">directories</span><span class="p">:</span>
<span class="w">    </span><span class="nt">projects</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;./projects&quot;</span>
<span class="w">    </span><span class="nt">data</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;./data&quot;</span>
<span class="w">    </span><span class="nt">exports</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;./exports&quot;</span>
<span class="w">    </span><span class="nt">logs</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;./logs&quot;</span>
<span class="w">    </span><span class="nt">temp</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;./temp&quot;</span>

<span class="w">  </span><span class="c1"># Rétention des données</span>
<span class="w">  </span><span class="nt">retention</span><span class="p">:</span>
<span class="w">    </span><span class="nt">raw_data_days</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30</span>
<span class="w">    </span><span class="nt">processed_data_days</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">90</span>
<span class="w">    </span><span class="nt">log_files_days</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">7</span>

<span class="c1"># Performance</span>
<span class="nt">performance</span><span class="p">:</span>
<span class="w">  </span><span class="nt">enable_monitoring</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">max_memory_mb</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2048</span>
<span class="w">  </span><span class="nt">enable_multiprocessing</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">max_workers</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4</span>

<span class="w">  </span><span class="c1"># Optimisations</span>
<span class="w">  </span><span class="nt">optimizations</span><span class="p">:</span>
<span class="w">    </span><span class="nt">use_numba</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">enable_caching</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">cache_size_mb</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">256</span>

<span class="c1"># Sécurité</span>
<span class="nt">security</span><span class="p">:</span>
<span class="w">  </span><span class="nt">enable_data_validation</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">enable_input_sanitization</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">max_file_size_mb</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1024</span>

<span class="c1"># Export</span>
<span class="nt">export</span><span class="p">:</span>
<span class="w">  </span><span class="nt">default_format</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;csv&quot;</span>
<span class="w">  </span><span class="nt">include_metadata</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>

<span class="w">  </span><span class="nt">formats</span><span class="p">:</span>
<span class="w">    </span><span class="nt">csv</span><span class="p">:</span>
<span class="w">      </span><span class="nt">delimiter</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;,&quot;</span>
<span class="w">      </span><span class="nt">encoding</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;utf-8&quot;</span>

<span class="w">    </span><span class="nt">excel</span><span class="p">:</span>
<span class="w">      </span><span class="nt">engine</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;openpyxl&quot;</span>
<span class="w">      </span><span class="nt">include_charts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>

<span class="w">    </span><span class="nt">matlab</span><span class="p">:</span>
<span class="w">      </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;7.3&quot;</span>
<span class="w">      </span><span class="nt">compression</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</pre></div>
</div>
<p><strong>Configuration des capteurs (config/sensors.yaml) :</strong></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># Configuration des capteurs</span>
<span class="nt">sensors</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># Capteur de houle résistif</span>
<span class="w">  </span><span class="nt">wave_gauge_resistive</span><span class="p">:</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;resistive_wave_gauge&quot;</span>
<span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Capteur</span><span class="nv"> </span><span class="s">de</span><span class="nv"> </span><span class="s">houle</span><span class="nv"> </span><span class="s">résistif&quot;</span>

<span class="w">    </span><span class="c1"># Paramètres physiques</span>
<span class="w">    </span><span class="nt">physical</span><span class="p">:</span>
<span class="w">      </span><span class="nt">sensitivity</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.0</span><span class="w">      </span><span class="c1"># mm/V</span>
<span class="w">      </span><span class="nt">range_min</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">-500.0</span><span class="w">     </span><span class="c1"># mm</span>
<span class="w">      </span><span class="nt">range_max</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">500.0</span><span class="w">      </span><span class="c1"># mm</span>
<span class="w">      </span><span class="nt">accuracy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.1</span><span class="w">         </span><span class="c1"># mm</span>
<span class="w">      </span><span class="nt">resolution</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.01</span><span class="w">      </span><span class="c1"># mm</span>

<span class="w">    </span><span class="c1"># Calibration</span>
<span class="w">    </span><span class="nt">calibration</span><span class="p">:</span>
<span class="w">      </span><span class="nt">offset</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0</span>
<span class="w">      </span><span class="nt">gain</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.0</span>
<span class="w">      </span><span class="nt">polynomial_coeffs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">0.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">1.0</span><span class="p p-Indicator">]</span><span class="w">  </span><span class="c1"># Correction polynomiale</span>

<span class="w">    </span><span class="c1"># Communication</span>
<span class="w">    </span><span class="nt">communication</span><span class="p">:</span>
<span class="w">      </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;serial&quot;</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;COM1&quot;</span>
<span class="w">      </span><span class="nt">baudrate</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">115200</span>
<span class="w">      </span><span class="nt">data_format</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ascii&quot;</span>
<span class="w">      </span><span class="nt">terminator</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;\r\n&quot;</span>

<span class="w">  </span><span class="c1"># Capteur de houle capacitif</span>
<span class="w">  </span><span class="nt">wave_gauge_capacitive</span><span class="p">:</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;capacitive_wave_gauge&quot;</span>
<span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Capteur</span><span class="nv"> </span><span class="s">de</span><span class="nv"> </span><span class="s">houle</span><span class="nv"> </span><span class="s">capacitif&quot;</span>

<span class="w">    </span><span class="nt">physical</span><span class="p">:</span>
<span class="w">      </span><span class="nt">sensitivity</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2.0</span>
<span class="w">      </span><span class="nt">range_min</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">-300.0</span>
<span class="w">      </span><span class="nt">range_max</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">300.0</span>
<span class="w">      </span><span class="nt">accuracy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.05</span>
<span class="w">      </span><span class="nt">resolution</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.005</span>

<span class="w">    </span><span class="nt">calibration</span><span class="p">:</span>
<span class="w">      </span><span class="nt">offset</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0</span>
<span class="w">      </span><span class="nt">gain</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.0</span>
<span class="w">      </span><span class="nt">temperature_compensation</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">      </span><span class="nt">temp_coeff</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">-0.001</span><span class="w">    </span><span class="c1"># %/°C</span>

<span class="w">    </span><span class="nt">communication</span><span class="p">:</span>
<span class="w">      </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;serial&quot;</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;COM2&quot;</span>
<span class="w">      </span><span class="nt">baudrate</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">9600</span>
<span class="w">      </span><span class="nt">data_format</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;binary&quot;</span>

<span class="c1"># Configurations prédéfinies</span>
<span class="nt">configurations</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># Configuration bassin simple</span>
<span class="w">  </span><span class="nt">single_basin</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Bassin</span><span class="nv"> </span><span class="s">simple&quot;</span>
<span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Configuration</span><span class="nv"> </span><span class="s">pour</span><span class="nv"> </span><span class="s">bassin</span><span class="nv"> </span><span class="s">d&#39;essai</span><span class="nv"> </span><span class="s">simple&quot;</span>
<span class="w">    </span><span class="nt">sensors</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">sensor_id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;WG01&quot;</span>
<span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;wave_gauge_resistive&quot;</span>
<span class="w">        </span><span class="nt">position</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt">x</span><span class="p">:</span><span class="w"> </span><span class="nv">0.0</span><span class="p p-Indicator">,</span><span class="nt"> y</span><span class="p">:</span><span class="w"> </span><span class="nv">0.0</span><span class="p p-Indicator">,</span><span class="nt"> z</span><span class="p">:</span><span class="w"> </span><span class="nv">0.0</span><span class="p p-Indicator">}</span>
<span class="w">        </span><span class="nt">active</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>

<span class="w">    </span><span class="nt">sampling</span><span class="p">:</span>
<span class="w">      </span><span class="nt">rate</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1000.0</span>
<span class="w">      </span><span class="nt">duration</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">300.0</span><span class="w">  </span><span class="c1"># 5 minutes</span>

<span class="w">  </span><span class="c1"># Configuration canal à houle</span>
<span class="w">  </span><span class="nt">wave_channel</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Canal</span><span class="nv"> </span><span class="s">à</span><span class="nv"> </span><span class="s">houle&quot;</span>
<span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Configuration</span><span class="nv"> </span><span class="s">pour</span><span class="nv"> </span><span class="s">canal</span><span class="nv"> </span><span class="s">à</span><span class="nv"> </span><span class="s">houle</span><span class="nv"> </span><span class="s">2D&quot;</span>
<span class="w">    </span><span class="nt">sensors</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">sensor_id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;WG01&quot;</span>
<span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;wave_gauge_resistive&quot;</span>
<span class="w">        </span><span class="nt">position</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt">x</span><span class="p">:</span><span class="w"> </span><span class="nv">0.0</span><span class="p p-Indicator">,</span><span class="nt"> y</span><span class="p">:</span><span class="w"> </span><span class="nv">0.0</span><span class="p p-Indicator">,</span><span class="nt"> z</span><span class="p">:</span><span class="w"> </span><span class="nv">0.0</span><span class="p p-Indicator">}</span>
<span class="w">        </span><span class="nt">active</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">sensor_id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;WG02&quot;</span>
<span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;wave_gauge_resistive&quot;</span>
<span class="w">        </span><span class="nt">position</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt">x</span><span class="p">:</span><span class="w"> </span><span class="nv">1.0</span><span class="p p-Indicator">,</span><span class="nt"> y</span><span class="p">:</span><span class="w"> </span><span class="nv">0.0</span><span class="p p-Indicator">,</span><span class="nt"> z</span><span class="p">:</span><span class="w"> </span><span class="nv">0.0</span><span class="p p-Indicator">}</span>
<span class="w">        </span><span class="nt">active</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">sensor_id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;WG03&quot;</span>
<span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;wave_gauge_capacitive&quot;</span>
<span class="w">        </span><span class="nt">position</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt">x</span><span class="p">:</span><span class="w"> </span><span class="nv">2.0</span><span class="p p-Indicator">,</span><span class="nt"> y</span><span class="p">:</span><span class="w"> </span><span class="nv">0.0</span><span class="p p-Indicator">,</span><span class="nt"> z</span><span class="p">:</span><span class="w"> </span><span class="nv">0.0</span><span class="p p-Indicator">}</span>
<span class="w">        </span><span class="nt">active</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>

<span class="w">    </span><span class="nt">sampling</span><span class="p">:</span>
<span class="w">      </span><span class="nt">rate</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2000.0</span>
<span class="w">      </span><span class="nt">duration</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">600.0</span><span class="w">  </span><span class="c1"># 10 minutes</span>

<span class="w">  </span><span class="c1"># Configuration bassin 3D</span>
<span class="w">  </span><span class="nt">basin_3d</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Bassin</span><span class="nv"> </span><span class="s">3D&quot;</span>
<span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Configuration</span><span class="nv"> </span><span class="s">pour</span><span class="nv"> </span><span class="s">bassin</span><span class="nv"> </span><span class="s">d&#39;essai</span><span class="nv"> </span><span class="s">3D&quot;</span>
<span class="w">    </span><span class="nt">sensors</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">sensor_id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;WG01&quot;</span>
<span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;wave_gauge_resistive&quot;</span>
<span class="w">        </span><span class="nt">position</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt">x</span><span class="p">:</span><span class="w"> </span><span class="nv">-1.0</span><span class="p p-Indicator">,</span><span class="nt"> y</span><span class="p">:</span><span class="w"> </span><span class="nv">-1.0</span><span class="p p-Indicator">,</span><span class="nt"> z</span><span class="p">:</span><span class="w"> </span><span class="nv">0.0</span><span class="p p-Indicator">}</span>
<span class="w">        </span><span class="nt">active</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">sensor_id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;WG02&quot;</span>
<span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;wave_gauge_resistive&quot;</span>
<span class="w">        </span><span class="nt">position</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt">x</span><span class="p">:</span><span class="w"> </span><span class="nv">1.0</span><span class="p p-Indicator">,</span><span class="nt"> y</span><span class="p">:</span><span class="w"> </span><span class="nv">-1.0</span><span class="p p-Indicator">,</span><span class="nt"> z</span><span class="p">:</span><span class="w"> </span><span class="nv">0.0</span><span class="p p-Indicator">}</span>
<span class="w">        </span><span class="nt">active</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">sensor_id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;WG03&quot;</span>
<span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;wave_gauge_resistive&quot;</span>
<span class="w">        </span><span class="nt">position</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt">x</span><span class="p">:</span><span class="w"> </span><span class="nv">-1.0</span><span class="p p-Indicator">,</span><span class="nt"> y</span><span class="p">:</span><span class="w"> </span><span class="nv">1.0</span><span class="p p-Indicator">,</span><span class="nt"> z</span><span class="p">:</span><span class="w"> </span><span class="nv">0.0</span><span class="p p-Indicator">}</span>
<span class="w">        </span><span class="nt">active</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">sensor_id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;WG04&quot;</span>
<span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;wave_gauge_resistive&quot;</span>
<span class="w">        </span><span class="nt">position</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt">x</span><span class="p">:</span><span class="w"> </span><span class="nv">1.0</span><span class="p p-Indicator">,</span><span class="nt"> y</span><span class="p">:</span><span class="w"> </span><span class="nv">1.0</span><span class="p p-Indicator">,</span><span class="nt"> z</span><span class="p">:</span><span class="w"> </span><span class="nv">0.0</span><span class="p p-Indicator">}</span>
<span class="w">        </span><span class="nt">active</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>

<span class="w">    </span><span class="nt">sampling</span><span class="p">:</span>
<span class="w">      </span><span class="nt">rate</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1000.0</span>
<span class="w">      </span><span class="nt">duration</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1200.0</span><span class="w">  </span><span class="c1"># 20 minutes</span>
</pre></div>
</div>
</section>
<section id="script-de-deploiement">
<h3>Script de Déploiement<a class="headerlink" href="#script-de-deploiement" title="Lien vers cette rubrique"></a></h3>
<p><strong>Script de construction (scripts/build_release.py) :</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Script de construction de release CHNeoWave.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">shutil</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">subprocess</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">zipfile</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">argparse</span>

<span class="k">class</span><span class="w"> </span><span class="nc">ReleaseBuilder</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Constructeur de release.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="n">target_platform</span><span class="o">=</span><span class="s2">&quot;windows&quot;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="n">version</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target_platform</span> <span class="o">=</span> <span class="n">target_platform</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">project_root</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">build_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_root</span> <span class="o">/</span> <span class="s2">&quot;build&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dist_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_root</span> <span class="o">/</span> <span class="s2">&quot;dist&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">clean_build_dirs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Nettoyage des répertoires de build.&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Nettoyage des répertoires de build...&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">dir_path</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">build_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dist_dir</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">dir_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">dir_path</span><span class="p">)</span>
            <span class="n">dir_path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">run_tests</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Exécution des tests.&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Exécution des tests...&quot;</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">executable</span><span class="p">,</span> <span class="s2">&quot;-m&quot;</span><span class="p">,</span> <span class="s2">&quot;pytest&quot;</span><span class="p">,</span>
            <span class="s2">&quot;tests/&quot;</span><span class="p">,</span>
            <span class="s2">&quot;-v&quot;</span><span class="p">,</span>
            <span class="s2">&quot;--cov=src/hrneowave&quot;</span><span class="p">,</span>
            <span class="s2">&quot;--cov-report=html&quot;</span><span class="p">,</span>
            <span class="s2">&quot;--cov-report=term&quot;</span>
        <span class="p">],</span> <span class="n">cwd</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project_root</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">returncode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Les tests ont échoué&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">build_documentation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Construction de la documentation.&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Construction de la documentation...&quot;</span><span class="p">)</span>

        <span class="n">docs_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_root</span> <span class="o">/</span> <span class="s2">&quot;docs&quot;</span>
        <span class="n">build_docs_dir</span> <span class="o">=</span> <span class="n">docs_dir</span> <span class="o">/</span> <span class="s2">&quot;_build&quot;</span>

        <span class="c1"># Nettoyage</span>
        <span class="k">if</span> <span class="n">build_docs_dir</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">build_docs_dir</span><span class="p">)</span>

        <span class="c1"># Construction Sphinx</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span>
            <span class="s2">&quot;sphinx-build&quot;</span><span class="p">,</span>
            <span class="s2">&quot;-b&quot;</span><span class="p">,</span> <span class="s2">&quot;html&quot;</span><span class="p">,</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">docs_dir</span><span class="p">),</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">build_docs_dir</span> <span class="o">/</span> <span class="s2">&quot;html&quot;</span><span class="p">)</span>
        <span class="p">])</span>

        <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">returncode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Construction de la documentation échouée&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">build_executable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Construction de l&#39;exécutable.&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Construction de l&#39;exécutable...&quot;</span><span class="p">)</span>

        <span class="c1"># Utilisation du script make_dist.py existant</span>
        <span class="n">make_dist_script</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_root</span> <span class="o">/</span> <span class="s2">&quot;scripts&quot;</span> <span class="o">/</span> <span class="s2">&quot;make_dist.py&quot;</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">executable</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">make_dist_script</span><span class="p">)</span>
        <span class="p">],</span> <span class="n">cwd</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">project_root</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">returncode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Construction de l&#39;exécutable échouée&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">create_installer_package</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Création du package d&#39;installation.&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Création du package d&#39;installation...&quot;</span><span class="p">)</span>

        <span class="n">package_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;CHNeoWave-</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">target_platform</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">package_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dist_dir</span> <span class="o">/</span> <span class="n">package_name</span>
        <span class="n">package_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Copie de l&#39;exécutable</span>
        <span class="n">exe_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dist_dir</span> <span class="o">/</span> <span class="s2">&quot;CHNeoWave.exe&quot;</span>
        <span class="k">if</span> <span class="n">exe_file</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="n">exe_file</span><span class="p">,</span> <span class="n">package_dir</span><span class="p">)</span>

        <span class="c1"># Copie des fichiers de configuration</span>
        <span class="n">config_dir</span> <span class="o">=</span> <span class="n">package_dir</span> <span class="o">/</span> <span class="s2">&quot;config&quot;</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">copytree</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">project_root</span> <span class="o">/</span> <span class="s2">&quot;config&quot;</span><span class="p">,</span>
            <span class="n">config_dir</span><span class="p">,</span>
            <span class="n">ignore</span><span class="o">=</span><span class="n">shutil</span><span class="o">.</span><span class="n">ignore_patterns</span><span class="p">(</span><span class="s2">&quot;*.pyc&quot;</span><span class="p">,</span> <span class="s2">&quot;__pycache__&quot;</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># Copie de la documentation</span>
        <span class="n">docs_build_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_root</span> <span class="o">/</span> <span class="s2">&quot;docs&quot;</span> <span class="o">/</span> <span class="s2">&quot;_build&quot;</span> <span class="o">/</span> <span class="s2">&quot;html&quot;</span>
        <span class="k">if</span> <span class="n">docs_build_dir</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="n">docs_package_dir</span> <span class="o">=</span> <span class="n">package_dir</span> <span class="o">/</span> <span class="s2">&quot;documentation&quot;</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">copytree</span><span class="p">(</span><span class="n">docs_build_dir</span><span class="p">,</span> <span class="n">docs_package_dir</span><span class="p">)</span>

        <span class="c1"># Fichiers README et LICENSE</span>
        <span class="k">for</span> <span class="n">file_name</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;README.md&quot;</span><span class="p">,</span> <span class="s2">&quot;LICENSE&quot;</span><span class="p">,</span> <span class="s2">&quot;CHANGELOG.md&quot;</span><span class="p">]:</span>
            <span class="n">src_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_root</span> <span class="o">/</span> <span class="n">file_name</span>
            <span class="k">if</span> <span class="n">src_file</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                <span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="n">src_file</span><span class="p">,</span> <span class="n">package_dir</span><span class="p">)</span>

        <span class="c1"># Script d&#39;installation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_create_install_script</span><span class="p">(</span><span class="n">package_dir</span><span class="p">)</span>

        <span class="c1"># Création de l&#39;archive ZIP</span>
        <span class="n">zip_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dist_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">package_name</span><span class="si">}</span><span class="s2">.zip&quot;</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">zip_file</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZIP_DEFLATED</span><span class="p">)</span> <span class="k">as</span> <span class="n">zf</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="n">package_dir</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">file_path</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
                    <span class="n">arc_name</span> <span class="o">=</span> <span class="n">file_path</span><span class="o">.</span><span class="n">relative_to</span><span class="p">(</span><span class="n">package_dir</span><span class="p">)</span>
                    <span class="n">zf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">arc_name</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Package créé: </span><span class="si">{</span><span class="n">zip_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">zip_file</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_create_install_script</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">package_dir</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Création du script d&#39;installation.&quot;&quot;&quot;</span>
        <span class="n">install_script</span> <span class="o">=</span> <span class="n">package_dir</span> <span class="o">/</span> <span class="s2">&quot;install.bat&quot;</span>

        <span class="n">script_content</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
</pre></div>
</div>
<p>&#64;echo off
echo Installation de CHNeoWave v{self.version}
echo.</p>
<p>REM Création du répertoire d’installation
set INSTALL_DIR=%PROGRAMFILES%CHNeoWave
if not exist « %INSTALL_DIR% » mkdir « %INSTALL_DIR% »</p>
<p>REM Copie des fichiers
echo Copie des fichiers…
copy CHNeoWave.exe « %INSTALL_DIR%&quot;
xcopy config « %INSTALL_DIR%config&quot; /E /I /Y
xcopy documentation « %INSTALL_DIR%documentation&quot; /E /I /Y</p>
<p>REM Création du raccourci sur le bureau
echo Création du raccourci…
set DESKTOP=%USERPROFILE%Desktop
echo Set oWS = WScript.CreateObject(« WScript.Shell ») &gt; CreateShortcut.vbs
echo sLinkFile = « %DESKTOP%CHNeoWave.lnk » &gt;&gt; CreateShortcut.vbs
echo Set oLink = oWS.CreateShortcut(sLinkFile) &gt;&gt; CreateShortcut.vbs
echo oLink.TargetPath = « %INSTALL_DIR%CHNeoWave.exe » &gt;&gt; CreateShortcut.vbs
echo oLink.WorkingDirectory = « %INSTALL_DIR% » &gt;&gt; CreateShortcut.vbs
echo oLink.Description = « CHNeoWave - Logiciel d’analyse de houle » &gt;&gt; CreateShortcut.vbs
echo oLink.Save &gt;&gt; CreateShortcut.vbs
cscript CreateShortcut.vbs
del CreateShortcut.vbs</p>
<p>echo.
echo Installation terminée!
echo CHNeoWave est installé dans: %INSTALL_DIR%
echo Un raccourci a été créé sur le bureau.
echo.
pause
« «  »</p>
<blockquote>
<div><blockquote>
<div><blockquote>
<div><dl class="simple">
<dt>with open(install_script, “w”, encoding=”utf-8”) as f:</dt><dd><p>f.write(script_content)</p>
</dd>
</dl>
</div></blockquote>
<dl>
<dt>def build_release(self):</dt><dd><p>« «  »Construction complète de la release. » » »
print(f »Construction de CHNeoWave v{self.version} »)
print(« = » * 50)</p>
<dl>
<dt>try:</dt><dd><p># Étapes de construction
self.clean_build_dirs()
self.run_tests()
self.build_documentation()
self.build_executable()
package_file = self.create_installer_package()</p>
<p>print( »n » + « = » * 50)
print(« Construction terminée avec succès! »)
print(f »Package: {package_file} »)</p>
<p>return package_file</p>
</dd>
<dt>except Exception as e:</dt><dd><p>print(f »nErreur lors de la construction: {e} »)
sys.exit(1)</p>
</dd>
</dl>
</dd>
</dl>
</div></blockquote>
<dl>
<dt>def main():</dt><dd><p>parser = argparse.ArgumentParser(description= »Construction de release CHNeoWave »)
parser.add_argument(« version », help= »Version de la release (ex: 1.0.0) »)
parser.add_argument( »–platform », default= »windows »,</p>
<blockquote>
<div><p>choices=[« windows », « linux », « macos »],
help= »Plateforme cible »)</p>
</div></blockquote>
<p>args = parser.parse_args()</p>
<p>builder = ReleaseBuilder(args.version, args.platform)
builder.build_release()</p>
</dd>
<dt>if __name__ == « __main__ »:</dt><dd><p>main()</p>
</dd>
</dl>
</div></blockquote>
</section>
</section>
<section id="depannage-et-maintenance">
<h2>Dépannage et Maintenance<a class="headerlink" href="#depannage-et-maintenance" title="Lien vers cette rubrique"></a></h2>
<section id="problemes-courants">
<h3>Problèmes Courants<a class="headerlink" href="#problemes-courants" title="Lien vers cette rubrique"></a></h3>
<p><strong>Problème : Erreur de connexion série</strong></p>
<p><em>Symptômes :</em>
- Message « Impossible de se connecter au port série »
- Acquisition qui ne démarre pas</p>
<p><em>Solutions :</em></p>
<ol class="arabic simple">
<li><p>Vérifier que le port série est correct :</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">serial.tools.list_ports</span>

<span class="c1"># Lister les ports disponibles</span>
<span class="n">ports</span> <span class="o">=</span> <span class="n">serial</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">list_ports</span><span class="o">.</span><span class="n">comports</span><span class="p">()</span>
<span class="k">for</span> <span class="n">port</span> <span class="ow">in</span> <span class="n">ports</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Port: </span><span class="si">{</span><span class="n">port</span><span class="o">.</span><span class="n">device</span><span class="si">}</span><span class="s2">, Description: </span><span class="si">{</span><span class="n">port</span><span class="o">.</span><span class="n">description</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Vérifier les paramètres de communication :</p></li>
</ol>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># Dans config/sensors.yaml</span>
<span class="nt">communication</span><span class="p">:</span>
<span class="w">  </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;COM1&quot;</span><span class="w">        </span><span class="c1"># Vérifier le bon port</span>
<span class="w">  </span><span class="nt">baudrate</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">115200</span><span class="w">    </span><span class="c1"># Vérifier la vitesse</span>
<span class="w">  </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2.0</span><span class="w">        </span><span class="c1"># Augmenter si nécessaire</span>
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>Tester la connexion manuellement :</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">serial</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">ser</span> <span class="o">=</span> <span class="n">serial</span><span class="o">.</span><span class="n">Serial</span><span class="p">(</span><span class="s1">&#39;COM1&#39;</span><span class="p">,</span> <span class="mi">115200</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Connexion réussie&quot;</span><span class="p">)</span>

    <span class="c1"># Test de lecture</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">ser</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Données reçues: </span><span class="si">{</span><span class="n">data</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">ser</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Erreur: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Problème : Performance dégradée</strong></p>
<p><em>Symptômes :</em>
- Interface qui rame
- Acquisition qui saute des échantillons
- Utilisation mémoire élevée</p>
<p><em>Solutions :</em></p>
<ol class="arabic simple">
<li><p>Réduire la fréquence d’affichage :</p></li>
</ol>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># Dans config/app_config.yaml</span>
<span class="nt">gui</span><span class="p">:</span>
<span class="w">  </span><span class="nt">update_rates</span><span class="p">:</span>
<span class="w">    </span><span class="nt">real_time_display</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span><span class="w">  </span><span class="c1"># Réduire de 30 à 10 Hz</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Optimiser les buffers :</p></li>
</ol>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">acquisition</span><span class="p">:</span>
<span class="w">  </span><span class="nt">buffer_size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4096</span><span class="w">     </span><span class="c1"># Réduire si nécessaire</span>
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>Activer les optimisations :</p></li>
</ol>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">performance</span><span class="p">:</span>
<span class="w">  </span><span class="nt">optimizations</span><span class="p">:</span>
<span class="w">    </span><span class="nt">use_numba</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">enable_caching</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</pre></div>
</div>
<p><strong>Problème : Fichiers corrompus</strong></p>
<p><em>Symptômes :</em>
- Erreur lors de l’ouverture de fichiers HDF5
- Données manquantes</p>
<p><em>Solutions :</em></p>
<ol class="arabic simple">
<li><p>Vérification d’intégrité :</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">h5py</span>

<span class="k">def</span><span class="w"> </span><span class="nf">check_hdf5_integrity</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="c1"># Vérification des groupes principaux</span>
            <span class="n">required_groups</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;metadata&#39;</span><span class="p">,</span> <span class="s1">&#39;raw_data&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">required_groups</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">group</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Groupe manquant: </span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="kc">False</span>

            <span class="c1"># Vérification des données</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;raw_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;raw_data&#39;</span><span class="p">][</span><span class="n">key</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Données vides: </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="kc">False</span>

            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Fichier intègre&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fichier corrompu: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Récupération de données :</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">recover_partial_data</span><span class="p">(</span><span class="n">corrupted_file</span><span class="p">,</span> <span class="n">output_file</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Récupération de données partielles.&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">corrupted_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f_in</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f_out</span><span class="p">:</span>

                <span class="c1"># Copie des métadonnées si disponibles</span>
                <span class="k">if</span> <span class="s1">&#39;metadata&#39;</span> <span class="ow">in</span> <span class="n">f_in</span><span class="p">:</span>
                    <span class="n">f_in</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="s1">&#39;metadata&#39;</span><span class="p">,</span> <span class="n">f_out</span><span class="p">)</span>

                <span class="c1"># Copie des données récupérables</span>
                <span class="k">if</span> <span class="s1">&#39;raw_data&#39;</span> <span class="ow">in</span> <span class="n">f_in</span><span class="p">:</span>
                    <span class="n">raw_group</span> <span class="o">=</span> <span class="n">f_out</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s1">&#39;raw_data&#39;</span><span class="p">)</span>

                    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">f_in</span><span class="p">[</span><span class="s1">&#39;raw_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">data</span> <span class="o">=</span> <span class="n">f_in</span><span class="p">[</span><span class="s1">&#39;raw_data&#39;</span><span class="p">][</span><span class="n">key</span><span class="p">][:]</span>
                            <span class="n">raw_group</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Récupéré: </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="si">}</span><span class="s2"> points)&quot;</span><span class="p">)</span>
                        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Impossible de récupérer </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Données récupérées dans: </span><span class="si">{</span><span class="n">output_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Échec de récupération: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="logs-et-diagnostic">
<h3>Logs et Diagnostic<a class="headerlink" href="#logs-et-diagnostic" title="Lien vers cette rubrique"></a></h3>
<p><strong>Configuration des logs :</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging.handlers</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>

<span class="k">def</span><span class="w"> </span><span class="nf">setup_logging</span><span class="p">(</span><span class="n">log_level</span><span class="o">=</span><span class="s2">&quot;INFO&quot;</span><span class="p">,</span> <span class="n">log_dir</span><span class="o">=</span><span class="s2">&quot;logs&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Configuration du système de logs.&quot;&quot;&quot;</span>

    <span class="c1"># Création du répertoire de logs</span>
    <span class="n">log_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">log_dir</span><span class="p">)</span>
    <span class="n">log_path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Configuration du logger principal</span>
    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;chneowave&#39;</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">logging</span><span class="p">,</span> <span class="n">log_level</span><span class="o">.</span><span class="n">upper</span><span class="p">()))</span>

    <span class="c1"># Formatter</span>
    <span class="n">formatter</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">(</span>
        <span class="s1">&#39;</span><span class="si">%(asctime)s</span><span class="s1"> - </span><span class="si">%(name)s</span><span class="s1"> - </span><span class="si">%(levelname)s</span><span class="s1"> - </span><span class="si">%(message)s</span><span class="s1">&#39;</span>
    <span class="p">)</span>

    <span class="c1"># Handler pour fichier avec rotation</span>
    <span class="n">file_handler</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">handlers</span><span class="o">.</span><span class="n">RotatingFileHandler</span><span class="p">(</span>
        <span class="n">log_path</span> <span class="o">/</span> <span class="s1">&#39;chneowave.log&#39;</span><span class="p">,</span>
        <span class="n">maxBytes</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="mi">1024</span><span class="o">*</span><span class="mi">1024</span><span class="p">,</span>  <span class="c1"># 10MB</span>
        <span class="n">backupCount</span><span class="o">=</span><span class="mi">5</span>
    <span class="p">)</span>
    <span class="n">file_handler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">formatter</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">file_handler</span><span class="p">)</span>

    <span class="c1"># Handler pour console</span>
    <span class="n">console_handler</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">()</span>
    <span class="n">console_handler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">formatter</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">console_handler</span><span class="p">)</span>

    <span class="c1"># Loggers spécialisés</span>

    <span class="c1"># Logger acquisition</span>
    <span class="n">acq_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;chneowave.acquisition&#39;</span><span class="p">)</span>
    <span class="n">acq_handler</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">handlers</span><span class="o">.</span><span class="n">RotatingFileHandler</span><span class="p">(</span>
        <span class="n">log_path</span> <span class="o">/</span> <span class="s1">&#39;acquisition.log&#39;</span><span class="p">,</span>
        <span class="n">maxBytes</span><span class="o">=</span><span class="mi">5</span><span class="o">*</span><span class="mi">1024</span><span class="o">*</span><span class="mi">1024</span><span class="p">,</span>
        <span class="n">backupCount</span><span class="o">=</span><span class="mi">3</span>
    <span class="p">)</span>
    <span class="n">acq_handler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">formatter</span><span class="p">)</span>
    <span class="n">acq_logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">acq_handler</span><span class="p">)</span>

    <span class="c1"># Logger analyse</span>
    <span class="n">analysis_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;chneowave.analysis&#39;</span><span class="p">)</span>
    <span class="n">analysis_handler</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">handlers</span><span class="o">.</span><span class="n">RotatingFileHandler</span><span class="p">(</span>
        <span class="n">log_path</span> <span class="o">/</span> <span class="s1">&#39;analysis.log&#39;</span><span class="p">,</span>
        <span class="n">maxBytes</span><span class="o">=</span><span class="mi">5</span><span class="o">*</span><span class="mi">1024</span><span class="o">*</span><span class="mi">1024</span><span class="p">,</span>
        <span class="n">backupCount</span><span class="o">=</span><span class="mi">3</span>
    <span class="p">)</span>
    <span class="n">analysis_handler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">formatter</span><span class="p">)</span>
    <span class="n">analysis_logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">analysis_handler</span><span class="p">)</span>

    <span class="c1"># Logger erreurs</span>
    <span class="n">error_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;chneowave.errors&#39;</span><span class="p">)</span>
    <span class="n">error_handler</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">handlers</span><span class="o">.</span><span class="n">RotatingFileHandler</span><span class="p">(</span>
        <span class="n">log_path</span> <span class="o">/</span> <span class="s1">&#39;errors.log&#39;</span><span class="p">,</span>
        <span class="n">maxBytes</span><span class="o">=</span><span class="mi">5</span><span class="o">*</span><span class="mi">1024</span><span class="o">*</span><span class="mi">1024</span><span class="p">,</span>
        <span class="n">backupCount</span><span class="o">=</span><span class="mi">10</span>
    <span class="p">)</span>
    <span class="n">error_handler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">formatter</span><span class="p">)</span>
    <span class="n">error_handler</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">ERROR</span><span class="p">)</span>
    <span class="n">error_logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">error_handler</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">logger</span>
</pre></div>
</div>
<p><strong>Diagnostic automatique :</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">psutil</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">platform</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>

<span class="k">def</span><span class="w"> </span><span class="nf">generate_diagnostic_report</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Génération d&#39;un rapport de diagnostic.&quot;&quot;&quot;</span>

    <span class="n">report</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">),</span>
        <span class="s1">&#39;system&#39;</span><span class="p">:</span> <span class="p">{},</span>
        <span class="s1">&#39;application&#39;</span><span class="p">:</span> <span class="p">{},</span>
        <span class="s1">&#39;performance&#39;</span><span class="p">:</span> <span class="p">{},</span>
        <span class="s1">&#39;configuration&#39;</span><span class="p">:</span> <span class="p">{},</span>
        <span class="s1">&#39;errors&#39;</span><span class="p">:</span> <span class="p">[]</span>
    <span class="p">}</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Informations système</span>
        <span class="n">report</span><span class="p">[</span><span class="s1">&#39;system&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;platform&#39;</span><span class="p">:</span> <span class="n">platform</span><span class="o">.</span><span class="n">platform</span><span class="p">(),</span>
            <span class="s1">&#39;python_version&#39;</span><span class="p">:</span> <span class="n">sys</span><span class="o">.</span><span class="n">version</span><span class="p">,</span>
            <span class="s1">&#39;cpu_count&#39;</span><span class="p">:</span> <span class="n">psutil</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">(),</span>
            <span class="s1">&#39;memory_total_gb&#39;</span><span class="p">:</span> <span class="n">psutil</span><span class="o">.</span><span class="n">virtual_memory</span><span class="p">()</span><span class="o">.</span><span class="n">total</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1024</span><span class="o">**</span><span class="mi">3</span><span class="p">),</span>
            <span class="s1">&#39;disk_free_gb&#39;</span><span class="p">:</span> <span class="n">psutil</span><span class="o">.</span><span class="n">disk_usage</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">free</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1024</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="c1"># Informations application</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">hrneowave</span><span class="w"> </span><span class="kn">import</span> <span class="n">__version__</span>
        <span class="n">report</span><span class="p">[</span><span class="s1">&#39;application&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;version&#39;</span><span class="p">:</span> <span class="n">__version__</span><span class="p">,</span>
            <span class="s1">&#39;install_path&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="p">),</span>
            <span class="s1">&#39;config_files&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;app_config&#39;</span><span class="p">:</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;config/app_config.yaml&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">(),</span>
                <span class="s1">&#39;sensors_config&#39;</span><span class="p">:</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;config/sensors.yaml&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1"># Performance actuelle</span>
        <span class="n">process</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">Process</span><span class="p">()</span>
        <span class="n">report</span><span class="p">[</span><span class="s1">&#39;performance&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;cpu_percent&#39;</span><span class="p">:</span> <span class="n">psutil</span><span class="o">.</span><span class="n">cpu_percent</span><span class="p">(</span><span class="n">interval</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
            <span class="s1">&#39;memory_mb&#39;</span><span class="p">:</span> <span class="n">process</span><span class="o">.</span><span class="n">memory_info</span><span class="p">()</span><span class="o">.</span><span class="n">rss</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1024</span><span class="o">**</span><span class="mi">2</span><span class="p">),</span>
            <span class="s1">&#39;memory_percent&#39;</span><span class="p">:</span> <span class="n">process</span><span class="o">.</span><span class="n">memory_percent</span><span class="p">(),</span>
            <span class="s1">&#39;open_files&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">process</span><span class="o">.</span><span class="n">open_files</span><span class="p">()),</span>
            <span class="s1">&#39;threads&#39;</span><span class="p">:</span> <span class="n">process</span><span class="o">.</span><span class="n">num_threads</span><span class="p">()</span>
        <span class="p">}</span>

        <span class="c1"># Vérification de la configuration</span>
        <span class="n">config_issues</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Vérification des ports série</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">serial.tools.list_ports</span>
        <span class="n">available_ports</span> <span class="o">=</span> <span class="p">[</span><span class="n">port</span><span class="o">.</span><span class="n">device</span> <span class="k">for</span> <span class="n">port</span> <span class="ow">in</span> <span class="n">serial</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">list_ports</span><span class="o">.</span><span class="n">comports</span><span class="p">()]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">available_ports</span><span class="p">:</span>
            <span class="n">config_issues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Aucun port série disponible&quot;</span><span class="p">)</span>

        <span class="n">report</span><span class="p">[</span><span class="s1">&#39;configuration&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;available_serial_ports&#39;</span><span class="p">:</span> <span class="n">available_ports</span><span class="p">,</span>
            <span class="s1">&#39;issues&#39;</span><span class="p">:</span> <span class="n">config_issues</span>
        <span class="p">}</span>

        <span class="c1"># Analyse des logs d&#39;erreur récents</span>
        <span class="n">error_log</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;logs/errors.log&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">error_log</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">error_log</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
                <span class="n">recent_errors</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="mi">50</span><span class="p">:]</span>  <span class="c1"># 50 dernières lignes</span>
                <span class="n">report</span><span class="p">[</span><span class="s1">&#39;errors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">recent_errors</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">report</span><span class="p">[</span><span class="s1">&#39;errors&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Erreur génération rapport: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">report</span>

<span class="k">def</span><span class="w"> </span><span class="nf">save_diagnostic_report</span><span class="p">(</span><span class="n">report</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Sauvegarde du rapport de diagnostic.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">timestamp</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">_%H%M%S&#39;</span><span class="p">)</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;diagnostic_report_</span><span class="si">{</span><span class="n">timestamp</span><span class="si">}</span><span class="s2">.json&quot;</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">report</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Rapport de diagnostic sauvegardé: </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">filename</span>
</pre></div>
</div>
</section>
<section id="mise-a-jour-et-migration">
<h3>Mise à Jour et Migration<a class="headerlink" href="#mise-a-jour-et-migration" title="Lien vers cette rubrique"></a></h3>
<p><strong>Script de mise à jour :</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">shutil</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">packaging</span><span class="w"> </span><span class="kn">import</span> <span class="n">version</span>

<span class="k">class</span><span class="w"> </span><span class="nc">UpdateManager</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Gestionnaire de mises à jour.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">current_version</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_version</span> <span class="o">=</span> <span class="n">current_version</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backup_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;backups&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backup_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">check_for_updates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">update_server_url</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Vérification des mises à jour disponibles.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>

            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">update_server_url</span><span class="si">}</span><span class="s2">/latest_version&quot;</span><span class="p">)</span>
            <span class="n">latest_info</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

            <span class="n">latest_version</span> <span class="o">=</span> <span class="n">latest_info</span><span class="p">[</span><span class="s1">&#39;version&#39;</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">version</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">latest_version</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">version</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_version</span><span class="p">):</span>
                <span class="k">return</span> <span class="p">{</span>
                    <span class="s1">&#39;update_available&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                    <span class="s1">&#39;latest_version&#39;</span><span class="p">:</span> <span class="n">latest_version</span><span class="p">,</span>
                    <span class="s1">&#39;download_url&#39;</span><span class="p">:</span> <span class="n">latest_info</span><span class="p">[</span><span class="s1">&#39;download_url&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;changelog&#39;</span><span class="p">:</span> <span class="n">latest_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;changelog&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
                    <span class="s1">&#39;critical&#39;</span><span class="p">:</span> <span class="n">latest_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;critical&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
                <span class="p">}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;update_available&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Erreur vérification mise à jour: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">backup_current_installation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sauvegarde de l&#39;installation actuelle.&quot;&quot;&quot;</span>
        <span class="n">timestamp</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">_%H%M%S&#39;</span><span class="p">)</span>
        <span class="n">backup_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;backup_v</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">current_version</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">timestamp</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">backup_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">backup_dir</span> <span class="o">/</span> <span class="n">backup_name</span>

        <span class="c1"># Sauvegarde des fichiers critiques</span>
        <span class="n">critical_paths</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">&#39;config/&#39;</span><span class="p">,</span>
            <span class="s1">&#39;projects/&#39;</span><span class="p">,</span>
            <span class="s1">&#39;data/&#39;</span><span class="p">,</span>
            <span class="s1">&#39;src/hrneowave/&#39;</span>
        <span class="p">]</span>

        <span class="n">backup_path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">path_str</span> <span class="ow">in</span> <span class="n">critical_paths</span><span class="p">:</span>
            <span class="n">src_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">path_str</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">src_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">src_path</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>
                    <span class="n">shutil</span><span class="o">.</span><span class="n">copytree</span><span class="p">(</span>
                        <span class="n">src_path</span><span class="p">,</span>
                        <span class="n">backup_path</span> <span class="o">/</span> <span class="n">src_path</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                        <span class="n">ignore</span><span class="o">=</span><span class="n">shutil</span><span class="o">.</span><span class="n">ignore_patterns</span><span class="p">(</span><span class="s1">&#39;*.pyc&#39;</span><span class="p">,</span> <span class="s1">&#39;__pycache__&#39;</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="n">src_path</span><span class="p">,</span> <span class="n">backup_path</span><span class="p">)</span>

        <span class="c1"># Métadonnées de sauvegarde</span>
        <span class="n">backup_info</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;version&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_version</span><span class="p">,</span>
            <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">timestamp</span><span class="p">,</span>
            <span class="s1">&#39;paths_backed_up&#39;</span><span class="p">:</span> <span class="n">critical_paths</span>
        <span class="p">}</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">backup_path</span> <span class="o">/</span> <span class="s1">&#39;backup_info.json&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">backup_info</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Sauvegarde créée: </span><span class="si">{</span><span class="n">backup_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">backup_path</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">migrate_configuration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">old_version</span><span class="p">,</span> <span class="n">new_version</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Migration de configuration entre versions.&quot;&quot;&quot;</span>

        <span class="n">migration_rules</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;0.3.0&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;to&#39;</span><span class="p">:</span> <span class="s1">&#39;1.0.0&#39;</span><span class="p">,</span>
                <span class="s1">&#39;config_changes&#39;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s1">&#39;gui.theme&#39;</span><span class="p">:</span> <span class="s1">&#39;default&#39;</span><span class="p">,</span>  <span class="c1"># Nouvelle valeur par défaut</span>
                    <span class="s1">&#39;performance.enable_monitoring&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                    <span class="s1">&#39;security.enable_data_validation&#39;</span><span class="p">:</span> <span class="kc">True</span>
                <span class="p">},</span>
                <span class="s1">&#39;removed_keys&#39;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="s1">&#39;deprecated_setting&#39;</span>
                <span class="p">]</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">old_version</span> <span class="ow">in</span> <span class="n">migration_rules</span><span class="p">:</span>
            <span class="n">rules</span> <span class="o">=</span> <span class="n">migration_rules</span><span class="p">[</span><span class="n">old_version</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">version</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">new_version</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">version</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">rules</span><span class="p">[</span><span class="s1">&#39;to&#39;</span><span class="p">]):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_apply_migration_rules</span><span class="p">(</span><span class="n">rules</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_apply_migration_rules</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rules</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Application des règles de migration.&quot;&quot;&quot;</span>
        <span class="n">config_file</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;config/app_config.yaml&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">config_file</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="kn">import</span><span class="w"> </span><span class="nn">yaml</span>

            <span class="c1"># Chargement de la configuration</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">config_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">config</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

            <span class="c1"># Application des changements</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">rules</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;config_changes&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_set_nested_key</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

            <span class="c1"># Suppression des clés obsolètes</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">rules</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;removed_keys&#39;</span><span class="p">,</span> <span class="p">[]):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_remove_nested_key</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>

            <span class="c1"># Sauvegarde</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">config_file</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">default_flow_style</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">allow_unicode</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Configuration migrée avec succès&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_set_nested_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">key_path</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Définition d&#39;une clé imbriquée.&quot;&quot;&quot;</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="n">key_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
        <span class="n">current</span> <span class="o">=</span> <span class="n">config</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">current</span><span class="p">:</span>
                <span class="n">current</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">current</span> <span class="o">=</span> <span class="n">current</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

        <span class="n">current</span><span class="p">[</span><span class="n">keys</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_remove_nested_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">key_path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Suppression d&#39;une clé imbriquée.&quot;&quot;&quot;</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="n">key_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
        <span class="n">current</span> <span class="o">=</span> <span class="n">config</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">current</span> <span class="o">=</span> <span class="n">current</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">keys</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">current</span><span class="p">:</span>
                <span class="k">del</span> <span class="n">current</span><span class="p">[</span><span class="n">keys</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>  <span class="c1"># Clé déjà absente</span>
</pre></div>
</div>
</section>
</section>
<section id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Lien vers cette rubrique"></a></h2>
<p>Ce guide technique fournit une vue d’ensemble complète de l’architecture et de l’implémentation de CHNeoWave. Il couvre :</p>
<ul class="simple">
<li><p><strong>Architecture système</strong> : Patterns MVC, composants principaux, patterns de conception</p></li>
<li><p><strong>Gestion des données</strong> : Format HDF5, validation, acquisition temps réel</p></li>
<li><p><strong>Interface utilisateur</strong> : Architecture MVC, Material Design, gestion des thèmes</p></li>
<li><p><strong>Performance</strong> : Monitoring, optimisation, gestion mémoire</p></li>
<li><p><strong>Tests</strong> : Architecture de tests, tests unitaires, intégration, performance</p></li>
<li><p><strong>Configuration</strong> : Fichiers YAML, déploiement, scripts de build</p></li>
<li><p><strong>Maintenance</strong> : Dépannage, logs, diagnostic, mises à jour</p></li>
</ul>
<p>Pour toute question technique ou contribution au projet, consultez la documentation de développement et les guides de contribution.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Ce guide est maintenu à jour avec chaque version de CHNeoWave.
Version du guide : 1.0.0
Dernière mise à jour : 24 juillet 2025</p>
</div>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Droits d'auteur 2024, Laboratoire d&#39;Études Maritimes.</p>
  </div>

  Compilé avec <a href="https://www.sphinx-doc.org/">Sphinx</a> en utilisant un
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">thème</a>
    fourni par <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>